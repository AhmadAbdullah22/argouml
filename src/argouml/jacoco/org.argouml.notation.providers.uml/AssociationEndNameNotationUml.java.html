<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AssociationEndNameNotationUml.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argouml-app</a> &gt; <a href="index.source.html" class="el_package">org.argouml.notation.providers.uml</a> &gt; <span class="el_source">AssociationEndNameNotationUml.java</span></div><h1>AssociationEndNameNotationUml.java</h1><pre class="source lang-java linenums">/* $Id$
 *****************************************************************************
 * Copyright (c) 2009-2011 Contributors - see below
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Michiel van der Wulp
 *****************************************************************************
 *
 * Some portions of this file was previously release using the BSD License:
 */

// Copyright (c) 2006-2009 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies. This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied &quot;AS
// IS&quot;, without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason. IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package org.argouml.notation.providers.uml;

import java.text.ParseException;
import java.util.NoSuchElementException;

import org.argouml.application.events.ArgoEventPump;
import org.argouml.application.events.ArgoEventTypes;
import org.argouml.application.events.ArgoHelpEvent;
import org.argouml.i18n.Translator;
import org.argouml.model.Facade;
import org.argouml.model.Model;
import org.argouml.notation.NotationSettings;
import org.argouml.notation.providers.AssociationEndNameNotation;
import org.argouml.uml.StereotypeUtility;
import org.argouml.util.MyTokenizer;

/**
 * The UML notation for an association-end name (i.e. the  role). &lt;p&gt;
 * 
 * This notation supports the association end name, 
 * visibility, and stereotypes. &lt;p&gt;
 * 
 * There is no support for the interface specifier
 * (that maps to the &quot;specification&quot; of an AssociationEnd). &lt;p&gt;
 * 
 * This is the only notation (that I'm aware of) that requires state.
 * All others could become effectively singletons. - Bob.
 * 
 * @author michiel
 */
public class AssociationEndNameNotationUml extends AssociationEndNameNotation {
	
    /**
     * The constructor.
     * 
     * @param associationEnd the UML element
     */
    public AssociationEndNameNotationUml(Object associationEnd) {
<span class="fc" id="L77">        super(associationEnd);</span>
<span class="fc" id="L78">    }</span>

    /*
     * @see org.argouml.notation.providers.NotationProvider#getParsingHelp()
     */
    public String getParsingHelp() {
<span class="nc" id="L84">        return &quot;parsing.help.fig-association-end-name&quot;;</span>
    }

    /*
     * @see org.argouml.notation.providers.NotationProvider#parse(java.lang.Object, java.lang.String)
     */
    public void parse(Object modelElement, String text) {
        try {
<span class="nc" id="L92">            parseAssociationEnd(modelElement, text);</span>
<span class="nc" id="L93">        } catch (ParseException pe) {</span>
<span class="nc" id="L94">            String msg = &quot;statusmsg.bar.error.parsing.association-end-name&quot;;</span>
<span class="nc" id="L95">            Object[] args = {</span>
<span class="nc" id="L96">                pe.getLocalizedMessage(),</span>
<span class="nc" id="L97">                Integer.valueOf(pe.getErrorOffset()),</span>
            };
<span class="nc" id="L99">            ArgoEventPump.fireEvent(new ArgoHelpEvent(</span>
                    ArgoEventTypes.HELP_CHANGED, this,
<span class="nc" id="L101">                Translator.messageFormat(msg, args)));</span>
<span class="nc" id="L102">        }</span>
<span class="nc" id="L103">    }</span>

    /**
     * Parse a line of the form: &lt;pre&gt;
     *          [/] [visibility] name
     * &lt;/pre&gt;&lt;p&gt;
     * 
     * Stereotypes can be given between any element. It must be given 
     * in the form: 
     * &amp;lt;&amp;lt;stereotype1,stereotype2,stereotype3&amp;gt;&amp;gt;
     * 
     * @param role   The AssociationEnd &lt;em&gt;text&lt;/em&gt; describes.
     * @param text A String on the above format.
     * @throws ParseException
     *             when it detects an error in the role string. See also
     *             ParseError.getErrorOffset().
     */
    protected void parseAssociationEnd(Object role, String text)
        throws ParseException {
        MyTokenizer st;

<span class="nc" id="L124">        String name = null;</span>
<span class="nc" id="L125">        StringBuilder stereotype = null;</span>
        String token;
<span class="nc" id="L127">        boolean derived = false;</span>

<span class="nc" id="L129">        text = text.trim();</span>
        /* Handle Derived: */
<span class="nc bnc" id="L131" title="All 4 branches missed.">        if (text.length() &gt; 0 &amp;&amp; &quot;/&quot;.indexOf(text.charAt(0)) &gt;= 0) {</span>
<span class="nc" id="L132">            derived = true;</span>
<span class="nc" id="L133">            text = text.substring(1);</span>
<span class="nc" id="L134">            text = text.trim();</span>
        }
        
        try {
<span class="nc" id="L138">            st = new MyTokenizer(text, &quot;&lt;&lt;,\u00AB,\u00BB,&gt;&gt;&quot;);</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">            while (st.hasMoreTokens()) {</span>
<span class="nc" id="L140">                token = st.nextToken();</span>

<span class="nc bnc" id="L142" title="All 4 branches missed.">                if (&quot;&lt;&lt;&quot;.equals(token) || &quot;\u00AB&quot;.equals(token)) {</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">                    if (stereotype != null) {</span>
<span class="nc" id="L144">                    	String msg = </span>
                            &quot;parsing.error.association-name.twin-stereotypes&quot;;
<span class="nc" id="L146">                        throw new ParseException(Translator.localize(msg), </span>
<span class="nc" id="L147">                        		st.getTokenIndex());</span>
                    }

<span class="nc" id="L150">                    stereotype = new StringBuilder();</span>
                    while (true) {
<span class="nc" id="L152">                        token = st.nextToken();</span>
<span class="nc bnc" id="L153" title="All 4 branches missed.">                        if (&quot;&gt;&gt;&quot;.equals(token) || &quot;\u00BB&quot;.equals(token)) {</span>
<span class="nc" id="L154">                            break;</span>
                        }
<span class="nc" id="L156">                        stereotype.append(token);</span>
                    }
                } else {
<span class="nc bnc" id="L159" title="All 2 branches missed.">                    if (name != null) {</span>
<span class="nc" id="L160">                    	String msg = </span>
                    		&quot;parsing.error.association-name.twin-names&quot;;
<span class="nc" id="L162">                        throw new ParseException(Translator.localize(msg),</span>
<span class="nc" id="L163">                                st.getTokenIndex());</span>
                    }
<span class="nc" id="L165">                    name = token;</span>
                }
            }
<span class="nc" id="L168">        } catch (NoSuchElementException nsee) {</span>
<span class="nc" id="L169">    	    String ms = &quot;parsing.error.association-name.unexpected-end-element&quot;;</span>
<span class="nc" id="L170">            throw new ParseException(Translator.localize(ms),</span>
<span class="nc" id="L171">                    text.length());</span>
<span class="nc" id="L172">        } catch (ParseException pre) {</span>
<span class="nc" id="L173">            throw pre;</span>
<span class="nc" id="L174">        }</span>

<span class="nc" id="L176">        dealWithDerived(role, derived);</span>

<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (name != null) {</span>
<span class="nc" id="L179">            name = name.trim();</span>
        }

<span class="nc bnc" id="L182" title="All 4 branches missed.">        if (name != null &amp;&amp; name.startsWith(&quot;+&quot;)) {</span>
<span class="nc" id="L183">            name = name.substring(1).trim();</span>
<span class="nc" id="L184">            Model.getCoreHelper().setVisibility(role,</span>
<span class="nc" id="L185">                            Model.getVisibilityKind().getPublic());</span>
        }
<span class="nc bnc" id="L187" title="All 4 branches missed.">        if (name != null &amp;&amp; name.startsWith(&quot;-&quot;)) {</span>
<span class="nc" id="L188">            name = name.substring(1).trim();</span>
<span class="nc" id="L189">            Model.getCoreHelper().setVisibility(role,</span>
<span class="nc" id="L190">                            Model.getVisibilityKind().getPrivate());</span>
        }
<span class="nc bnc" id="L192" title="All 4 branches missed.">        if (name != null &amp;&amp; name.startsWith(&quot;#&quot;)) {</span>
<span class="nc" id="L193">            name = name.substring(1).trim();</span>
<span class="nc" id="L194">            Model.getCoreHelper().setVisibility(role,</span>
<span class="nc" id="L195">                            Model.getVisibilityKind().getProtected());</span>
        }
<span class="nc bnc" id="L197" title="All 4 branches missed.">        if (name != null &amp;&amp; name.startsWith(&quot;~&quot;)) {</span>
<span class="nc" id="L198">            name = name.substring(1).trim();</span>
<span class="nc" id="L199">            Model.getCoreHelper().setVisibility(role,</span>
<span class="nc" id="L200">                            Model.getVisibilityKind().getPackage());</span>
        }
<span class="nc bnc" id="L202" title="All 2 branches missed.">        if (name != null) {</span>
<span class="nc" id="L203">            Model.getCoreHelper().setName(role, name);</span>
        }

<span class="nc" id="L206">        StereotypeUtility.dealWithStereotypes(role, stereotype, true);</span>
<span class="nc" id="L207">    }</span>

    private void dealWithDerived(Object umlObject, boolean derived) {
<span class="nc" id="L210">        NotationUtilityUml.setDerived(umlObject, derived);</span>
<span class="nc" id="L211">    }</span>

    private String toString(Object modelElement, boolean showVisibility,
            boolean useGuillemets) {
        // TODO: This whole block can be deleted when issue 6266 is resolved
<span class="pc bpc" id="L216" title="1 of 2 branches missed.">        if (Model.getFacade().isAConnectorEnd(modelElement)) {</span>
<span class="nc" id="L217">            return &quot;&quot;;</span>
        }
        // end of block
<span class="fc" id="L220">        String derived = &quot;&quot;;</span>
<span class="fc" id="L221">        Object tv = Model.getFacade().getTaggedValue(modelElement, </span>
                Facade.DERIVED_TAG);
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">        if (tv != null) {</span>
<span class="nc" id="L224">            String tag = Model.getFacade().getValueOfTag(tv);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">            if (&quot;true&quot;.equalsIgnoreCase(tag)) {</span>
<span class="nc" id="L226">                derived = &quot;/&quot;;</span>
            }
        }   
        
<span class="fc" id="L230">        String name = Model.getFacade().getName(modelElement);</span>
<span class="fc bfc" id="L231" title="All 2 branches covered.">        if (name == null) {</span>
<span class="fc" id="L232">            name = &quot;&quot;;</span>
        }

<span class="fc" id="L235">        String visibility = &quot;&quot;;</span>
<span class="pc bpc" id="L236" title="1 of 2 branches missed.">        if (showVisibility) {</span>
<span class="nc" id="L237">            visibility = NotationUtilityUml.generateVisibility2(modelElement);</span>

<span class="nc bnc" id="L239" title="All 2 branches missed.">            if (name.length() &lt; 1) {</span>
<span class="nc" id="L240">                visibility = &quot;&quot;;</span>
                // this is the temporary solution for issue 1011
            }
        }

<span class="fc" id="L245">        String stereoString = </span>
<span class="fc" id="L246">            NotationUtilityUml.generateStereotype(modelElement, useGuillemets);</span>

<span class="pc bpc" id="L248" title="1 of 2 branches missed.">        if (stereoString.length() &gt; 0) {</span>
<span class="nc" id="L249">            stereoString += &quot; &quot;;</span>
        }

<span class="fc" id="L252">        return derived + stereoString + visibility + name;</span>
    }

    @Override
    public String toString(Object modelElement, NotationSettings settings) {
<span class="fc" id="L257">        return toString(modelElement, settings.isShowVisibilities(), </span>
<span class="fc" id="L258">                settings.isUseGuillemets());</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>