<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FigActor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argouml-app</a> &gt; <a href="index.source.html" class="el_package">org.argouml.uml.diagram.use_case.ui</a> &gt; <span class="el_source">FigActor.java</span></div><h1>FigActor.java</h1><pre class="source lang-java linenums">/* $Id$
 *****************************************************************************
 * Copyright (c) 2009 Contributors - see below
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    mvw
 *****************************************************************************
 *
 * Some portions of this file was previously release using the BSD License:
 */

// Copyright (c) 1996-2009 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies.  This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied &quot;AS
// IS&quot;, without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason.  IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package org.argouml.uml.diagram.use_case.ui;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.event.MouseEvent;
import java.beans.PropertyChangeEvent;
import java.util.ArrayList;
import java.util.List;
import java.util.Vector;

import org.argouml.model.Model;
import org.argouml.uml.diagram.DiagramSettings;
import org.argouml.uml.diagram.ui.ArgoFigUtil;
import org.argouml.uml.diagram.ui.FigNodeModelElement;
import org.tigris.gef.base.Selection;
import org.tigris.gef.presentation.Fig;
import org.tigris.gef.presentation.FigCircle;
import org.tigris.gef.presentation.FigLine;
import org.tigris.gef.presentation.FigRect;

/**
 * Class to display graphics for an Actor in a diagram. &lt;p&gt;
 * 
 * The dimensions of the stick-man figure are fixed at 40 wide by 55 high.
 * It does not support different line-widths.&lt;p&gt;
 * 
 * Stereotypes and the name are shown below the stick-man.&lt;p&gt;
 * 
 *  This seems to be the only ArgoUML element where the stereotypes 
 *  are shown below the name. The UML 1.4.2 standard does not forbid nor 
 *  prescribe this layout detail.
 */
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">public class FigActor extends FigNodeModelElement {</span>

    /**
     * The padding between the actor body and name and the top of the
     * stereotype.
     */
    protected static final int MIN_VERT_PADDING = 4;

    //These are the positions of child figs inside this fig
    //They must be added in the constructor in this order.
    //For now the name must not be last as this would force
    //zero width lines (until GEF is fixed)
    private static final int HEAD_POSN = 2;
    private static final int BODY_POSN = 3;
    private static final int ARMS_POSN = 4;
    private static final int LEFT_LEG_POSN = 5;
    private static final int RIGHT_LEG_POSN = 6;

    private void constructFigs(Rectangle bounds) {

        
<span class="fc" id="L96">        FigCircle head =</span>
            new FigCircle(X0 + 2, Y0, 16, 15);
<span class="fc" id="L98">        FigLine body = new FigLine(X0 + 10, Y0 + 15, 20, 40);</span>
<span class="fc" id="L99">        FigLine arms = new FigLine(X0, Y0 + 20, 30, 30);</span>
<span class="fc" id="L100">        FigLine leftLeg = new FigLine(X0 + 10, Y0 + 30, 15, 55);</span>
<span class="fc" id="L101">        FigLine rightLeg = new FigLine(X0 + 10, Y0 + 30, 25, 55);</span>
        
<span class="fc" id="L103">        getNameFig().setBounds(X0, Y0 + 45, 20, 20);</span>

<span class="fc" id="L105">        getNameFig().setTextFilled(false);</span>
<span class="fc" id="L106">        getNameFig().setFilled(false);</span>
<span class="fc" id="L107">        getNameFig().setLineWidth(0);</span>
        // initialize any other Figs here
<span class="fc" id="L109">        getStereotypeFig().setBounds(getBigPort().getCenter().x,</span>
<span class="fc" id="L110">                                     getBigPort().getCenter().y,</span>
                                     0, 0);
<span class="fc" id="L112">        setSuppressCalcBounds(true);</span>
        // add Figs to the FigNode in back-to-front order
        // Put this rectangle behind the rest, so it goes first
<span class="fc" id="L115">        addFig(getBigPort());</span>
<span class="fc" id="L116">        addFig(getNameFig());</span>
<span class="fc" id="L117">        addFig(head);</span>
<span class="fc" id="L118">        addFig(body);</span>
<span class="fc" id="L119">        addFig(arms);</span>
<span class="fc" id="L120">        addFig(leftLeg);</span>
<span class="fc" id="L121">        addFig(rightLeg);</span>
<span class="fc" id="L122">        addFig(getStereotypeFig());</span>
        
<span class="fc" id="L124">        bindPort(getOwner(), getBigPort());</span>
<span class="fc" id="L125">        setResizable(false);</span>
        
<span class="fc" id="L127">        setFilled(true);</span>
<span class="fc" id="L128">        setFillColor(FILL_COLOR);</span>
<span class="fc" id="L129">        setLineColor(LINE_COLOR);</span>
<span class="fc" id="L130">        setLineWidth(LINE_WIDTH);</span>
<span class="fc" id="L131">        setTextColor(TEXT_COLOR);</span>
        
        /* Set the drop location in the case of D&amp;D: */
<span class="fc bfc" id="L134" title="All 2 branches covered.">        if (bounds != null) {</span>
<span class="fc" id="L135">            setLocation(bounds.x, bounds.y);</span>
        }

<span class="fc" id="L138">        setSuppressCalcBounds(false);</span>
<span class="fc" id="L139">        setBounds(getBounds());</span>
<span class="fc" id="L140">    }</span>
    
    @Override
    protected Fig createBigPortFig() {
<span class="fc" id="L144">        return new ActorPortFigRect(X0, Y0, 0, 0, this);</span>
    }

    /**
     * Construct a new Actor with the given owner, bounds, and settings.  This
     * constructor is used by the PGML parser.
     * 
     * @param owner model element that owns this fig
     * @param bounds position and size
     * @param settings rendering settings
     */
    public FigActor(Object owner, Rectangle bounds, 
            DiagramSettings settings) {
<span class="fc" id="L157">        super(owner, bounds, settings);</span>
<span class="fc" id="L158">        constructFigs(bounds);</span>
<span class="fc" id="L159">    }</span>
    
    public void paint(Graphics g) {
<span class="nc" id="L162">        forceRepaintShadow();</span>
<span class="nc" id="L163">        super.paint(g);</span>
<span class="nc" id="L164">    }</span>

    @Override
    public void setLineWidth(int width) {
        /* This sets the lineWidth of all in the group: */
<span class="fc" id="L169">        super.setLineWidth(width);</span>
        /* NameFig and StereotypeFig are handled by parent. */
<span class="fc" id="L171">    }</span>
    
    @Override
    public void setFillColor(Color col) {
<span class="fc" id="L175">        super.setFillColor(col);</span>
<span class="fc" id="L176">        getStereotypeFig().setFillColor(null);</span>
<span class="fc" id="L177">        getNameFig().setFillColor(null);</span>
<span class="fc" id="L178">    }</span>

    @Override
    public void setFilled(boolean filled) {
<span class="fc" id="L182">        super.setFilled(filled);</span>
<span class="fc" id="L183">        getBigPort().setFilled(false);</span>
<span class="fc" id="L184">        getNameFig().setFilled(false);</span>
<span class="fc" id="L185">        getStereotypeFig().setFilled(false);</span>
        // Only the head should be filled (not the text)
<span class="fc" id="L187">    }</span>

    @Override
    public Selection makeSelection() {
<span class="nc" id="L191">        return new SelectionActor(this);</span>
    }

    @Override
    public Vector getPopUpActions(MouseEvent me) {
<span class="nc" id="L196">        Vector popUpActions = super.getPopUpActions(me);</span>
        // Modifiers ...
<span class="nc" id="L198">        popUpActions.add(</span>
<span class="nc" id="L199">                popUpActions.size() - getPopupAddOffset(),</span>
<span class="nc" id="L200">                buildModifierPopUp(ABSTRACT | LEAF | ROOT));</span>
<span class="nc" id="L201">        return popUpActions;</span>
    }

    @Override
    public boolean isResizable() {
<span class="fc" id="L206">        return false;</span>
    }

    @Override
    public Dimension getMinimumSize() {
<span class="fc" id="L211">        Dimension aSize = new Dimension(40, 55);</span>
<span class="fc" id="L212">        aSize = ArgoFigUtil.addChildDimensions(aSize, getNameFig());</span>
<span class="fc" id="L213">        aSize = ArgoFigUtil.addChildDimensions(aSize, getStereotypeFig());</span>
<span class="fc" id="L214">        return aSize;</span>
    }

    @Override
    protected void setStandardBounds(final int x, final int y, 
            final int w, final int h) {

<span class="fc" id="L221">        Rectangle oldBounds = getBounds();</span>
        
        // Make sure we don't try to set things smaller than the minimum
<span class="fc" id="L224">        Dimension minimumSize = getMinimumSize();</span>
<span class="fc" id="L225">        int newW = Math.max(w, minimumSize.width);</span>
<span class="fc" id="L226">        int newH = Math.max(h, minimumSize.height);</span>

<span class="fc" id="L228">        int middle = x + newW / 2;</span>

<span class="fc" id="L230">        getFigAt(HEAD_POSN).setLocation(</span>
<span class="fc" id="L231">                middle - getFigAt(HEAD_POSN).getWidth() / 2, y + 10);</span>
<span class="fc" id="L232">        getFigAt(BODY_POSN).setLocation(middle, y + 25);</span>
<span class="fc" id="L233">        getFigAt(ARMS_POSN).setLocation(</span>
<span class="fc" id="L234">                middle - getFigAt(ARMS_POSN).getWidth() / 2, y + 30);</span>
<span class="fc" id="L235">        getFigAt(LEFT_LEG_POSN).setLocation(</span>
<span class="fc" id="L236">                middle - getFigAt(LEFT_LEG_POSN).getWidth(), y + 40);</span>
<span class="fc" id="L237">        getFigAt(RIGHT_LEG_POSN).setLocation(middle, y +  40);</span>

<span class="fc" id="L239">        Dimension minTextSize = getNameFig().getMinimumSize();</span>
<span class="fc" id="L240">        getNameFig().setBounds(middle - minTextSize.width / 2,</span>
	        y +  55,
	        minTextSize.width,
	        minTextSize.height);

<span class="pc bpc" id="L245" title="1 of 2 branches missed.">        if (getStereotypeFig().isVisible()) {</span>
<span class="fc" id="L246">            Dimension minStereoSize = getStereotypeFig().getMinimumSize();</span>
<span class="pc bpc" id="L247" title="2 of 4 branches missed.">            assert minStereoSize.width &lt;= newW;</span>
<span class="fc" id="L248">            getStereotypeFig().setBounds(middle - minStereoSize.width / 2,</span>
<span class="fc" id="L249">                    y + 55 + getNameFig().getHeight(),</span>
                    minStereoSize.width, 
                    minStereoSize.height);
        }

<span class="fc" id="L254">        getBigPort().setBounds(x, y, newW, newH);</span>

<span class="fc" id="L256">        calcBounds(); //Accumulate a bounding box for all the Figs in the group.</span>
<span class="fc" id="L257">        firePropChange(&quot;bounds&quot;, oldBounds, getBounds());</span>
<span class="fc" id="L258">        updateEdges();</span>
<span class="fc" id="L259">    }</span>

    @Override
    public Object deepHitPort(int x, int y) {
<span class="nc" id="L263">        Object o = super.deepHitPort(x, y);</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">        if (o != null) {</span>
<span class="nc" id="L265">            return o;</span>
        }
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (hit(new Rectangle(new Dimension(x, y)))) {</span>
<span class="nc" id="L268">            return getOwner();</span>
        }
<span class="nc" id="L270">        return null;</span>
    }

    /*
     * Makes sure that the edges stick to the outline of the fig.
     * @see org.tigris.gef.presentation.Fig#getGravityPoints()
     */
    @Override
    public List&lt;Point&gt; getGravityPoints() {
<span class="fc" id="L279">        final int maxPoints = 20;</span>
<span class="fc" id="L280">        List&lt;Point&gt; ret = new ArrayList&lt;Point&gt;();</span>
<span class="fc" id="L281">        int cx = getFigAt(HEAD_POSN).getCenter().x;</span>
<span class="fc" id="L282">        int cy = getFigAt(HEAD_POSN).getCenter().y;</span>
<span class="fc" id="L283">        int radiusx = Math.round(getFigAt(HEAD_POSN).getWidth() / 2) + 1;</span>
<span class="fc" id="L284">        int radiusy = Math.round(getFigAt(HEAD_POSN).getHeight() / 2) + 1;</span>
<span class="fc" id="L285">        Point point = null;</span>
<span class="fc bfc" id="L286" title="All 2 branches covered.">        for (int i = 0; i &lt; maxPoints; i++) {</span>
<span class="fc" id="L287">            double angle = 2 * Math.PI / maxPoints * i;</span>
<span class="fc" id="L288">            point =</span>
<span class="fc" id="L289">                new Point((int) (cx + Math.cos(angle) * radiusx),</span>
<span class="fc" id="L290">                          (int) (cy + Math.sin(angle) * radiusy));</span>
<span class="fc" id="L291">            ret.add(point);</span>
        }
<span class="fc" id="L293">        ret.add(new Point(((FigLine) getFigAt(LEFT_LEG_POSN)).getX2(),</span>
<span class="fc" id="L294">                          ((FigLine) getFigAt(LEFT_LEG_POSN)).getY2()));</span>
<span class="fc" id="L295">        ret.add(new Point(((FigLine) getFigAt(RIGHT_LEG_POSN)).getX2(),</span>
<span class="fc" id="L296">                          ((FigLine) getFigAt(RIGHT_LEG_POSN)).getY2()));</span>
<span class="fc" id="L297">        ret.add(new Point(((FigLine) getFigAt(RIGHT_LEG_POSN)).getX2(),</span>
<span class="fc" id="L298">                          ((FigLine) getFigAt(RIGHT_LEG_POSN)).getY2() + getNameFig().getHeight()));</span>
<span class="fc" id="L299">        ret.add(new Point(((FigLine) getFigAt(ARMS_POSN)).getX1(),</span>
<span class="fc" id="L300">                          ((FigLine) getFigAt(ARMS_POSN)).getY1()));</span>
<span class="fc" id="L301">        ret.add(new Point(((FigLine) getFigAt(ARMS_POSN)).getX2(),</span>
<span class="fc" id="L302">                          ((FigLine) getFigAt(ARMS_POSN)).getY2()));</span>
<span class="fc" id="L303">        ret.add(new Point(((FigLine) getFigAt(LEFT_LEG_POSN)).getX2(),</span>
<span class="fc" id="L304">                          ((FigLine) getFigAt(LEFT_LEG_POSN)).getY2() + getNameFig().getHeight()));</span>
<span class="fc" id="L305">        return ret;</span>
    }

    @Override
    protected void modelChanged(PropertyChangeEvent mee) {
        //      name updating
<span class="nc" id="L311">        super.modelChanged(mee);</span>

<span class="nc" id="L313">        boolean damage = false;</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">        if (getOwner() == null) {</span>
<span class="nc" id="L315">            return;</span>
        }

<span class="nc bnc" id="L318" title="All 2 branches missed.">        if (mee == null </span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">                || mee.getPropertyName().equals(&quot;stereotype&quot;) </span>
<span class="nc" id="L320">                || Model.getFacade().getStereotypes(getOwner())</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">                                .contains(mee.getSource())) {</span>
<span class="nc" id="L322">            updateStereotypeText();</span>
<span class="nc" id="L323">            damage = true;</span>
        }

<span class="nc bnc" id="L326" title="All 2 branches missed.">        if (damage) {</span>
<span class="nc" id="L327">            damage();</span>
        }
<span class="nc" id="L329">    }</span>

    @Override
    protected int getNameFigFontStyle() {
<span class="fc" id="L333">        Object cls = getOwner();</span>
<span class="pc bpc" id="L334" title="1 of 2 branches missed.">        return Model.getFacade().isAbstract(cls) ? Font.ITALIC : Font.PLAIN;</span>
    }

    /**
     * The bigPort needs to overrule the getGravityPoints,
     * because it is the port of this FigNode.
     *
     * @author mvw
     */
    static class ActorPortFigRect extends FigRect {
        /**
         * the parent fig, i.e. the Actor
         */
        private Fig parent;

        /**
         * The constructor.
         *
         * @param x the x
         * @param y the y
         * @param w the width
         * @param h the height
         * @param p the Actor fig
         */
        public ActorPortFigRect(int x, int y, int w, int h, Fig p) {
<span class="fc" id="L359">            super(x, y, w, h, null, null);</span>
<span class="fc" id="L360">            parent = p;</span>
<span class="fc" id="L361">        }</span>

        /**
         * Makes sure that the edges stick to the outline of the fig.
         * @see org.tigris.gef.presentation.Fig#getGravityPoints()
         */
        @Override
        public List getGravityPoints() {
<span class="fc" id="L369">            return parent.getGravityPoints();</span>
        }

        @Override
        public void setFilled(boolean f) {
<span class="fc" id="L374">            super.setFilled(false);</span>
<span class="fc" id="L375">        }</span>

        @Override
        public void setLineWidth(int w) {
<span class="fc" id="L379">            super.setLineWidth(0);</span>
<span class="fc" id="L380">        }</span>

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>