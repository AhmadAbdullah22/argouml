<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ResourceLoader.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argouml-app</a> &gt; <a href="index.source.html" class="el_package">org.argouml.application.helpers</a> &gt; <span class="el_source">ResourceLoader.java</span></div><h1>ResourceLoader.java</h1><pre class="source lang-java linenums">/* $Id$
 *****************************************************************************
 * Copyright (c) 2009 Contributors - see below
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    tfmorris
 *****************************************************************************
 *
 * Some portions of this file was previously release using the BSD License:
 */

// Copyright (c) 1996-2006 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies.  This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied &quot;AS
// IS&quot;, without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason.  IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package org.argouml.application.helpers;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;

import javax.swing.Icon;
import javax.swing.ImageIcon;

/**
 * This class manages the resource locations needed within the application.
 * Already loaded resources are cached. The resources can be searched in
 * different locations.
 * &lt;p&gt;
 * Derived from org.tigris.gef.util.ResourceLoader with formatting and
 * variable naming changed to conform to ArgoUML coding standard.
 * &lt;p&gt;
 * We use a local copy to reduce coupling to GEF and so that GEF isn't trying
 * to do uplevel accesses to the application resources (which won't work in
 * environments that enforce strict partitioning between projects eg Eclipse).
 * 
 * @author Original Author: Thorsten Sturm
 */

// NOTE: This is package scope to force callers to use ResourceLoaderWrapper
<span class="nc" id="L65">class ResourceLoader {</span>
<span class="fc" id="L66">    private static HashMap&lt;String, Icon&gt; resourceCache = </span>
        new HashMap&lt;String, Icon&gt;();
<span class="fc" id="L68">    private static List&lt;String&gt; resourceLocations = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L69">    private static List&lt;String&gt; resourceExtensions = new ArrayList&lt;String&gt;();</span>

    public static ImageIcon lookupIconResource(String resource) {
<span class="fc" id="L72">        return lookupIconResource(resource, resource);</span>
    }

    public static ImageIcon lookupIconResource(String resource, String desc) {
<span class="fc" id="L76">        return lookupIconResource(resource, desc, null);</span>
    }

    public static ImageIcon lookupIconResource(String resource,
            ClassLoader loader) {
<span class="nc" id="L81">        return lookupIconResource(resource, resource, loader);</span>
    }

    /**
     * This method tries to find an ImageIcon for the given name in all known
     * locations. The file extension of the used image file can be any of the
     * known extensions.
     * 
     * @param resource
     *            Name of the image to be looked after.
     * @param desc
     *            A description for the ImageIcon.
     * @param loader
     *            The class loader that should be used for loading the resource.
     * @return ImageIcon for the given name, null if no image could be found.
     */
    public static ImageIcon lookupIconResource(String resource, String desc,
            ClassLoader loader) {
<span class="fc" id="L99">        resource = toJavaIdentifier(resource);</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">        if (isInCache(resource)) {</span>
<span class="fc" id="L101">            return (ImageIcon) resourceCache.get(resource);</span>
        }
    
<span class="fc" id="L104">        ImageIcon res = null;</span>
<span class="fc" id="L105">        java.net.URL imgURL = lookupIconUrl(resource, loader);</span>

<span class="fc bfc" id="L107" title="All 2 branches covered.">        if (imgURL != null) {</span>
<span class="fc" id="L108">            res = new ImageIcon(imgURL, desc);</span>
<span class="fc" id="L109">            synchronized (resourceCache) {</span>
<span class="fc" id="L110">                resourceCache.put(resource, res);</span>
<span class="fc" id="L111">            }</span>
        }
<span class="fc" id="L113">        return res;</span>
    }

    /**
     * Search for the given resource with one of the registered extensions, in
     * one of the registered locations. The URL of the first found is returned.
     * 
     * @param resource
     *            base name of resource to search for
     * @param loader
     *            class loader to use
     * @return URL representing first location the resource was found or null if
     *         it was not found in any of the registered locations.
     */
    static java.net.URL lookupIconUrl(String resource, 
            ClassLoader loader) {
<span class="fc" id="L129">        java.net.URL imgURL = null;</span>
<span class="fc" id="L130">        for (Iterator extensions = resourceExtensions.iterator(); </span>
<span class="fc bfc" id="L131" title="All 2 branches covered.">                extensions.hasNext();) {</span>
<span class="fc" id="L132">            String tmpExt = (String) extensions.next();</span>
<span class="fc" id="L133">            for (Iterator locations = resourceLocations.iterator(); </span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">                    locations.hasNext();) {</span>
<span class="fc" id="L135">                String imageName =</span>
<span class="fc" id="L136">                        locations.next() + &quot;/&quot; + resource + &quot;.&quot; + tmpExt;</span>
// System.out.println(&quot;[ResourceLoader] try loading &quot; + imageName);
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">                if (loader == null) {</span>
<span class="fc" id="L139">                    imgURL = ResourceLoader.class.getResource(imageName);</span>
                } else {
<span class="nc" id="L141">                    imgURL = loader.getResource(imageName);</span>
                }
<span class="fc bfc" id="L143" title="All 2 branches covered.">                if (imgURL != null) {</span>
<span class="fc" id="L144">                    break;</span>
                }
<span class="fc" id="L146">            }</span>
<span class="fc bfc" id="L147" title="All 2 branches covered.">            if (imgURL != null) {</span>
<span class="fc" id="L148">                break;</span>
            }
<span class="fc" id="L150">        }</span>
<span class="fc" id="L151">        return imgURL;</span>
    }

    /**
     * Adds a location (path) to the list of known locations. Locations are
     * searched in the order they are added, so for best performance add the
     * most likely locations first.
     * 
     * @param location
     *            String representation of the new location.
     */
    public static void addResourceLocation(String location) {
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">        if (!containsLocation(location)) {</span>
<span class="fc" id="L164">            resourceLocations.add(location);</span>
        }
<span class="fc" id="L166">    }</span>

    /**
     * Add an extension to the list of known extensions. Extensions are searched
     * in the order they are added, so for best performance add the most likely
     * extensions first.
     * 
     * @param extension
     *            String representation of the new extension.
     */
    public static void addResourceExtension(String extension) {
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">        if (!containsExtension(extension)) {</span>
<span class="fc" id="L178">            resourceExtensions.add(extension);</span>
        }
<span class="fc" id="L180">    }</span>

    /**
     * This method removes a location from the list of known locations.
     * 
     * @param location
     *            String representation of the location to be removed.
     */
    public static void removeResourceLocation(String location) {
<span class="nc bnc" id="L189" title="All 2 branches missed.">        for (Iterator iter = resourceLocations.iterator(); iter.hasNext();) {</span>
<span class="nc" id="L190">            String loc = (String) iter.next();</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">            if (loc.equals(location)) {</span>
<span class="nc" id="L192">                resourceLocations.remove(loc);</span>
<span class="nc" id="L193">                break;</span>
            }
<span class="nc" id="L195">        }</span>
<span class="nc" id="L196">    }</span>

    /**
     * This method removes a extension from the list of known extensions.
     *
     * @param extension String representation of the extension to be removed.
     */
    public static void removeResourceExtension(String extension) {
<span class="nc bnc" id="L204" title="All 2 branches missed.">        for (Iterator iter = resourceExtensions.iterator(); iter.hasNext();) {</span>
<span class="nc" id="L205">            String ext = (String) iter.next();</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">            if (ext.equals(extension)) {</span>
<span class="nc" id="L207">                resourceExtensions.remove(ext);</span>
<span class="nc" id="L208">                break;</span>
            }
<span class="nc" id="L210">        }</span>
<span class="nc" id="L211">    }</span>

    public static boolean containsExtension(String extension) {
<span class="fc" id="L214">        return resourceExtensions.contains(extension);</span>
    }

    public static boolean containsLocation(String location) {
<span class="fc" id="L218">        return resourceLocations.contains(location);</span>
    }

    public static boolean isInCache(String resource) {
<span class="fc" id="L222">        return resourceCache.containsKey(resource);</span>
    }
    
    /*
     * Strip all characters out of &lt;var&gt;s&lt;/var&gt; that could not be part of a
     * valid Java identifier. Return either the given string (if all characters
     * were valid), or a new string with all invalid characters stripped out.
     * This allows automatic conversion of strings containing punctuation and
     * spaces to a resource name that can be looked up.
     */
    public static final String toJavaIdentifier(String s) {
<span class="fc" id="L233">        int len = s.length();</span>
<span class="fc" id="L234">        int pos = 0;</span>
<span class="fc bfc" id="L235" title="All 2 branches covered.">        for (int i = 0; i &lt; len; i++, pos++) {</span>
<span class="fc bfc" id="L236" title="All 2 branches covered.">            if (!Character.isJavaIdentifierPart(s.charAt(i))) {</span>
<span class="fc" id="L237">                break;</span>
            }
        }
<span class="fc bfc" id="L240" title="All 2 branches covered.">        if (pos == len) {</span>
<span class="fc" id="L241">            return s;</span>
        }

<span class="fc" id="L244">        StringBuffer buf = new StringBuffer(len);</span>
<span class="fc" id="L245">        buf.append(s.substring(0, pos));</span>

        // skip pos, we know it's not a valid char from above
<span class="fc bfc" id="L248" title="All 2 branches covered.">        for (int i = pos + 1; i &lt; len; i++) {</span>
<span class="fc" id="L249">            char c = s.charAt(i);</span>
<span class="fc bfc" id="L250" title="All 2 branches covered.">            if (Character.isJavaIdentifierPart(c)) {</span>
<span class="fc" id="L251">                buf.append(c);</span>
            }
        }
<span class="fc" id="L254">        return buf.toString();</span>
    }
} /* end class ResourceLoader */

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>