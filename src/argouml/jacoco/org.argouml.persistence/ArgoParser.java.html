<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ArgoParser.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argouml-app</a> &gt; <a href="index.source.html" class="el_package">org.argouml.persistence</a> &gt; <span class="el_source">ArgoParser.java</span></div><h1>ArgoParser.java</h1><pre class="source lang-java linenums">/* $Id$
 *****************************************************************************
 * Copyright (c) 2009-2012 Contributors - see below
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    tfmorris
 *****************************************************************************
 *
 * Some portions of this file was previously release using the BSD License:
 */

// Copyright (c) 1996-2008 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies.  This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied &quot;AS
// IS&quot;, without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason.  IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package org.argouml.persistence;

import java.io.Reader;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;

import org.argouml.kernel.Project;
import org.argouml.kernel.ProjectSettings;
import org.argouml.notation.NotationSettings;
import org.argouml.uml.diagram.DiagramSettings;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;


/**
 * Parser for ArgoUML project description file (.argo).
 */
class ArgoParser extends SAXParserBase {

    /**
     * Logger.
     */
<span class="fc" id="L63">    private static final Logger LOG =</span>
<span class="fc" id="L64">        Logger.getLogger(ArgoParser.class.getName());</span>

    private Project project;

    private ProjectSettings ps;

    private DiagramSettings diagramDefaults;

    private NotationSettings notationSettings;

<span class="fc" id="L74">    private ArgoTokenTable tokens = new ArgoTokenTable();</span>

<span class="fc" id="L76">    private List&lt;String&gt; memberList = new ArrayList&lt;String&gt;();</span>

    /**
     * The constructor.
     *
     */
    public ArgoParser() {
<span class="fc" id="L83">        super();</span>
<span class="fc" id="L84">    }</span>

    /**
     * @param theProject the project to populate
     * @param source the input source
     * @throws SAXException on error when parsing xml
     */
    public void readProject(Project theProject, InputSource source)
        throws SAXException {

<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (source == null) {</span>
<span class="nc" id="L95">            throw new IllegalArgumentException(</span>
                    &quot;An InputSource must be supplied&quot;);
        }

<span class="nc" id="L99">        preRead(theProject);</span>

        try {
<span class="nc" id="L102">            parse(source);</span>
<span class="nc" id="L103">        } catch (SAXException e) {</span>
<span class="nc" id="L104">            logError(source.toString(), e);</span>
<span class="nc" id="L105">            throw e;</span>
<span class="nc" id="L106">        }</span>
<span class="nc" id="L107">    }</span>

    /**
     * @param theProject the project to populate
     * @param reader the reader
     * @throws SAXException on error when parsing xml
     */
    public void readProject(Project theProject, Reader reader)
    	throws SAXException {

<span class="pc bpc" id="L117" title="1 of 2 branches missed.">        if (reader == null) {</span>
<span class="nc" id="L118">            throw new IllegalArgumentException(</span>
                    &quot;A reader must be supplied&quot;);
        }

<span class="fc" id="L122">        preRead(theProject);</span>

        try {
<span class="fc" id="L125">            parse(reader);</span>
<span class="nc" id="L126">        } catch (SAXException e) {</span>
<span class="nc" id="L127">            logError(reader.toString(), e);</span>
<span class="nc" id="L128">            throw e;</span>
<span class="fc" id="L129">        }</span>
<span class="fc" id="L130">    }</span>

    private void preRead(Project theProject) {
<span class="fc" id="L133">        LOG.log(Level.INFO,</span>
                &quot;=======================================\n&quot;
                + &quot;== READING PROJECT {0}&quot;,
                theProject);

<span class="fc" id="L138">        project = theProject;</span>
<span class="fc" id="L139">        ps = project.getProjectSettings();</span>
<span class="fc" id="L140">        diagramDefaults = ps.getDefaultDiagramSettings();</span>
<span class="fc" id="L141">        notationSettings = ps.getNotationSettings();</span>
<span class="fc" id="L142">    }</span>

    private void logError(String projectName, SAXException e) {
<span class="nc" id="L145">        LOG.log(Level.SEVERE,</span>
                &quot;Exception reading project ================&quot;+projectName, e);
<span class="nc" id="L147">    }</span>

    /**
     * Get the project to which the URI is to be parsed.
     * @return the project
     */
    public Project getProject() {
<span class="nc" id="L154">        return project;</span>
    }

    /**
     * Set the project to which the URI is to be parsed.
     * @param newProj the project
     */
    public void setProject(Project newProj) {
<span class="nc" id="L162">        project = newProj;</span>
<span class="nc" id="L163">        ps = project.getProjectSettings();</span>
<span class="nc" id="L164">    }</span>

    /*
     * @see org.argouml.persistence.SAXParserBase#handleStartElement(
     *         org.argouml.persistence.XMLElement)
     */
    public void handleStartElement(XMLElement e) throws SAXException {
        if (DBG) {
            LOG.log(Level.FINE,
                    &quot;NOTE: ArgoParser handleStartTag: {0}&quot;, e.getName());
        }
<span class="fc bfc" id="L175" title="All 4 branches covered.">        switch (tokens.toToken(e.getName(), true)) {</span>
        case ArgoTokenTable.TOKEN_ARGO:
<span class="fc" id="L177">            handleArgo(e);</span>
<span class="fc" id="L178">            break;</span>
        case ArgoTokenTable.TOKEN_DOCUMENTATION:
<span class="fc" id="L180">            handleDocumentation(e);</span>
<span class="fc" id="L181">            break;</span>
        case ArgoTokenTable.TOKEN_SETTINGS:
<span class="fc" id="L183">            handleSettings(e);</span>
<span class="fc" id="L184">            break;</span>
        default:
            if (DBG) {
                LOG.log(Level.WARNING, &quot;WARNING: unknown tag:&quot; + e.getName());
            }
            break;
        }
<span class="fc" id="L191">    }</span>

    /*
     * @see org.argouml.persistence.SAXParserBase#handleEndElement(
     *         org.argouml.persistence.XMLElement)
     */
    @SuppressWarnings(&quot;deprecation&quot;)
    public void handleEndElement(XMLElement e) throws SAXException {
        if (DBG) {
            LOG.log(Level.FINE,
                    &quot;NOTE: ArgoParser handleEndTag: {0}&quot;, e.getName());
        }
<span class="fc bfc" id="L203" title="All 25 branches covered.">        switch (tokens.toToken(e.getName(), false)) {</span>
        case ArgoTokenTable.TOKEN_MEMBER:
<span class="fc" id="L205">            handleMember(e);</span>
<span class="fc" id="L206">            break;</span>
        case ArgoTokenTable.TOKEN_AUTHORNAME:
<span class="fc" id="L208">            handleAuthorName(e);</span>
<span class="fc" id="L209">            break;</span>
        case ArgoTokenTable.TOKEN_AUTHOREMAIL:
<span class="fc" id="L211">            handleAuthorEmail(e);</span>
<span class="fc" id="L212">            break;</span>
        case ArgoTokenTable.TOKEN_VERSION:
<span class="fc" id="L214">            handleVersion(e);</span>
<span class="fc" id="L215">            break;</span>
        case ArgoTokenTable.TOKEN_DESCRIPTION:
<span class="fc" id="L217">            handleDescription(e);</span>
<span class="fc" id="L218">            break;</span>
        case ArgoTokenTable.TOKEN_SEARCHPATH:
<span class="fc" id="L220">            handleSearchpath(e);</span>
<span class="fc" id="L221">            break;</span>
        case ArgoTokenTable.TOKEN_HISTORYFILE:
<span class="fc" id="L223">            handleHistoryfile(e);</span>
<span class="fc" id="L224">            break;</span>
        case ArgoTokenTable.TOKEN_NOTATIONLANGUAGE:
<span class="fc" id="L226">            handleNotationLanguage(e);</span>
<span class="fc" id="L227">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWBOLDNAMES:
<span class="fc" id="L229">            handleShowBoldNames(e);</span>
<span class="fc" id="L230">            break;</span>
        case ArgoTokenTable.TOKEN_USEGUILLEMOTS:
<span class="fc" id="L232">            handleUseGuillemots(e);</span>
<span class="fc" id="L233">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWVISIBILITY:
<span class="fc" id="L235">            handleShowVisibility(e);</span>
<span class="fc" id="L236">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWMULTIPLICITY:
<span class="fc" id="L238">            handleShowMultiplicity(e);</span>
<span class="fc" id="L239">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWINITIALVALUE:
<span class="fc" id="L241">            handleShowInitialValue(e);</span>
<span class="fc" id="L242">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWPROPERTIES:
<span class="fc" id="L244">            handleShowProperties(e);</span>
<span class="fc" id="L245">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWTYPES:
<span class="fc" id="L247">            handleShowTypes(e);</span>
<span class="fc" id="L248">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWSTEREOTYPES:
<span class="fc" id="L250">            handleShowStereotypes(e);</span>
<span class="fc" id="L251">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWSINGULARMULTIPLICITIES:
<span class="fc" id="L253">            handleShowSingularMultiplicities(e);</span>
<span class="fc" id="L254">            break;</span>
        case ArgoTokenTable.TOKEN_DEFAULTSHADOWWIDTH:
<span class="fc" id="L256">            handleDefaultShadowWidth(e);</span>
<span class="fc" id="L257">            break;</span>
        case ArgoTokenTable.TOKEN_FONTNAME:
<span class="fc" id="L259">            handleFontName(e);</span>
<span class="fc" id="L260">            break;</span>
        case ArgoTokenTable.TOKEN_FONTSIZE:
<span class="fc" id="L262">            handleFontSize(e);</span>
<span class="fc" id="L263">            break;</span>
        case ArgoTokenTable.TOKEN_GENERATION_OUTPUT_DIR:
            // ignored - it shouldn't have been in the project in the 1st place
<span class="fc" id="L266">            break;</span>
        case ArgoTokenTable.TOKEN_SHOWASSOCIATIONNAMES:
<span class="fc" id="L268">            handleShowAssociationNames(e);</span>
<span class="fc" id="L269">            break;</span>
        case ArgoTokenTable.TOKEN_HIDEBIDIRECTIONALARROWS:
<span class="fc" id="L271">            handleHideBidirectionalArrows(e);</span>
<span class="fc" id="L272">            break;</span>
        case ArgoTokenTable.TOKEN_ACTIVE_DIAGRAM:
<span class="fc" id="L274">            handleActiveDiagram(e);</span>
<span class="fc" id="L275">            break;</span>
        default:
            if (DBG) {
                LOG.log(Level.WARNING,
                        &quot;WARNING: unknown end tag:&quot; + e.getName());
            }
            break;
        }
<span class="fc" id="L283">    }</span>

    /*
     * @see org.argouml.persistence.SAXParserBase#isElementOfInterest(String)
     */
    @Override
    protected boolean isElementOfInterest(String name) {
<span class="fc" id="L290">        return tokens.contains(name);</span>
    }

    /**
     * @param e the element
     */
    protected void handleArgo(@SuppressWarnings(&quot;unused&quot;) XMLElement e) {
        /* do nothing */
<span class="fc" id="L298">    }</span>

    /**
     * @param e the element
     */
    protected void handleDocumentation(
            @SuppressWarnings(&quot;unused&quot;) XMLElement e) {
        /* do nothing */
<span class="fc" id="L306">    }</span>

    /**
     * @param e the element
     */
    protected void handleSettings(@SuppressWarnings(&quot;unused&quot;) XMLElement e) {
        /* do nothing */
<span class="fc" id="L313">    }</span>

    /**
     * @param e the element
     */
    protected void handleAuthorName(XMLElement e) {
<span class="fc" id="L319">        String authorname = e.getText().trim();</span>
<span class="fc" id="L320">        project.setAuthorname(authorname);</span>
<span class="fc" id="L321">    }</span>

    /**
     * @param e the element
     */
    protected void handleAuthorEmail(XMLElement e) {
<span class="fc" id="L327">        String authoremail = e.getText().trim();</span>
<span class="fc" id="L328">        project.setAuthoremail(authoremail);</span>
<span class="fc" id="L329">    }</span>

    /**
     * @param e the element
     */
    protected void handleVersion(XMLElement e) {
<span class="fc" id="L335">        String version = e.getText().trim();</span>
<span class="fc" id="L336">        project.setVersion(version);</span>
<span class="fc" id="L337">    }</span>

    /**
     * @param e the element
     */
    protected void handleDescription(XMLElement e) {
<span class="fc" id="L343">        String description = e.getText().trim();</span>
<span class="fc" id="L344">        project.setDescription(description);</span>
<span class="fc" id="L345">    }</span>

    /**
     * @param e the element
     */
    protected void handleSearchpath(XMLElement e) {
<span class="fc" id="L351">        String searchpath = e.getAttribute(&quot;href&quot;).trim();</span>
<span class="fc" id="L352">        project.addSearchPath(searchpath);</span>
<span class="fc" id="L353">    }</span>

    /**
     * @param e the element
     * @throws SAXException on any error parsing the member XML.
     */
    protected void handleMember(XMLElement e) throws SAXException {
<span class="pc bpc" id="L360" title="1 of 2 branches missed.">        if (e == null) {</span>
<span class="nc" id="L361">            throw new SAXException(&quot;XML element is null&quot;);</span>
        }
<span class="fc" id="L363">        String type = e.getAttribute(&quot;type&quot;);</span>
<span class="fc" id="L364">        memberList.add(type);</span>
<span class="fc" id="L365">    }</span>

    /**
     * @param e the element
     */
    protected void handleHistoryfile(XMLElement e) {
<span class="pc bpc" id="L371" title="1 of 2 branches missed.">        if (e.getAttribute(&quot;name&quot;) == null) {</span>
<span class="nc" id="L372">            return;</span>
        }
<span class="fc" id="L374">        String historyfile = e.getAttribute(&quot;name&quot;).trim();</span>
<span class="fc" id="L375">        project.setHistoryFile(historyfile);</span>
<span class="fc" id="L376">    }</span>

    /**
     * @param e the element
     */
    protected void handleNotationLanguage(XMLElement e) {
<span class="fc" id="L382">        String language = e.getText().trim();</span>
<span class="fc" id="L383">        boolean success = ps.setNotationLanguage(language);</span>
        /* TODO: Here we should e.g. show the user a message that
         * the loaded project was using a Notation that is not
         * currently available and a fall back on the default Notation
         * was done. Maybe this can be implemented in the
         * PersistenceManager? */
<span class="fc" id="L389">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowBoldNames(XMLElement e) {
<span class="fc" id="L395">        String ug = e.getText().trim();</span>
<span class="fc" id="L396">        diagramDefaults.setShowBoldNames(Boolean.parseBoolean(ug));</span>
<span class="fc" id="L397">    }</span>

    /**
     * @param e the element
     */
    protected void handleUseGuillemots(XMLElement e) {
<span class="fc" id="L403">        String ug = e.getText().trim();</span>
<span class="fc" id="L404">        ps.setUseGuillemots(ug);</span>
<span class="fc" id="L405">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowVisibility(XMLElement e) {
<span class="fc" id="L411">        String showVisibility = e.getText().trim();</span>
<span class="fc" id="L412">        notationSettings.setShowVisibilities(</span>
<span class="fc" id="L413">                Boolean.parseBoolean(showVisibility));</span>
<span class="fc" id="L414">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowMultiplicity(XMLElement e) {
<span class="fc" id="L420">        String showMultiplicity = e.getText().trim();</span>
<span class="fc" id="L421">        notationSettings.setShowMultiplicities(</span>
<span class="fc" id="L422">                Boolean.parseBoolean(showMultiplicity));</span>
<span class="fc" id="L423">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowInitialValue(XMLElement e) {
<span class="fc" id="L429">        String showInitialValue = e.getText().trim();</span>
<span class="fc" id="L430">        notationSettings.setShowInitialValues(</span>
<span class="fc" id="L431">                Boolean.parseBoolean(showInitialValue));</span>
<span class="fc" id="L432">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowProperties(XMLElement e) {
<span class="fc" id="L438">        String showproperties = e.getText().trim();</span>
<span class="fc" id="L439">        notationSettings.setShowProperties(</span>
<span class="fc" id="L440">                Boolean.parseBoolean(showproperties));</span>
<span class="fc" id="L441">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowTypes(XMLElement e) {
<span class="fc" id="L447">        String showTypes = e.getText().trim();</span>
<span class="fc" id="L448">        notationSettings.setShowTypes(Boolean.parseBoolean(showTypes));</span>
<span class="fc" id="L449">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowStereotypes(XMLElement e) {
<span class="fc" id="L455">        String showStereotypes = e.getText().trim();</span>
<span class="fc" id="L456">        ps.setShowStereotypes(Boolean.parseBoolean(showStereotypes));</span>
<span class="fc" id="L457">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowSingularMultiplicities(XMLElement e) {
<span class="fc" id="L463">        String showSingularMultiplicities = e.getText().trim();</span>
<span class="fc" id="L464">        notationSettings.setShowSingularMultiplicities(</span>
<span class="fc" id="L465">                Boolean.parseBoolean(showSingularMultiplicities));</span>
<span class="fc" id="L466">    }</span>

    /**
     * @param e the element
     */
    protected void handleDefaultShadowWidth(XMLElement e) {
<span class="fc" id="L472">        String dsw = e.getText().trim();</span>
<span class="fc" id="L473">        diagramDefaults.setDefaultShadowWidth(Integer.parseInt(dsw));</span>
<span class="fc" id="L474">    }</span>

    /**
     * @param e the element
     */
    protected void handleFontName(XMLElement e) {
<span class="fc" id="L480">        String dsw = e.getText().trim();</span>
<span class="fc" id="L481">        diagramDefaults.setFontName(dsw);</span>
<span class="fc" id="L482">    }</span>

    /**
     * @param e the element
     */
    protected void handleFontSize(XMLElement e) {
<span class="fc" id="L488">        String dsw = e.getText().trim();</span>
        try {
<span class="fc" id="L490">            diagramDefaults.setFontSize(Integer.parseInt(dsw));</span>
<span class="nc" id="L491">        } catch (NumberFormatException e1) {</span>
<span class="nc" id="L492">            LOG.log(Level.SEVERE,</span>
                    &quot;NumberFormatException while parsing Font Size&quot;, e1);
<span class="fc" id="L494">        }</span>
<span class="fc" id="L495">    }</span>

    /**
     * @param e the element
     */
    protected void handleShowAssociationNames(XMLElement e) {
<span class="fc" id="L501">        String showAssociationNames = e.getText().trim();</span>
<span class="fc" id="L502">        notationSettings.setShowAssociationNames(</span>
<span class="fc" id="L503">                Boolean.parseBoolean(showAssociationNames));</span>
<span class="fc" id="L504">    }</span>

    /**
     * @param e the element
     */
    protected void handleHideBidirectionalArrows(XMLElement e) {
<span class="fc" id="L510">        String hideBidirectionalArrows = e.getText().trim();</span>
        // NOTE: For historical reasons true == hide, so we need to invert
        // the sense of this
<span class="fc" id="L513">        diagramDefaults.setShowBidirectionalArrows(!</span>
<span class="pc bpc" id="L514" title="1 of 2 branches missed.">                Boolean.parseBoolean(hideBidirectionalArrows));</span>
<span class="fc" id="L515">    }</span>


    protected void handleActiveDiagram(XMLElement e) {
        /* At this stage during loading, the diagrams are
         * not created yet - so we have to store this name for later use. */
<span class="fc" id="L521">        project.setSavedDiagramName(e.getText().trim());</span>
<span class="fc" id="L522">    }</span>

    /**
     * Get the number of diagram members read.
     * @return the number of diagram members read.
     */
    public List&lt;String&gt; getMemberList() {
<span class="fc" id="L529">        return memberList;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>