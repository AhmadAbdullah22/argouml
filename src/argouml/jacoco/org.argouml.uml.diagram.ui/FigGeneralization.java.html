<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FigGeneralization.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argouml-app</a> &gt; <a href="index.source.html" class="el_package">org.argouml.uml.diagram.ui</a> &gt; <span class="el_source">FigGeneralization.java</span></div><h1>FigGeneralization.java</h1><pre class="source lang-java linenums">/* $Id$
 *****************************************************************************
 * Copyright (c) 2009 Contributors - see below
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    mvw
 *****************************************************************************
 *
 * Some portions of this file was previously release using the BSD License:
 */

// Copyright (c) 1996-2009 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies.  This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied &quot;AS
// IS&quot;, without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason.  IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package org.argouml.uml.diagram.ui;

import java.awt.Font;
import java.awt.Graphics;
import java.awt.Rectangle;
import java.beans.PropertyChangeEvent;

import org.argouml.model.AttributeChangeEvent;
import org.argouml.model.Model;
import org.argouml.uml.diagram.DiagramSettings;
import org.tigris.gef.presentation.ArrowHeadTriangle;
import org.tigris.gef.presentation.Fig;
import org.tigris.gef.presentation.FigText;

/**
 * The Fig for a Generalization.
 * 
 * @author abonner@ics.uci.edu, jaap.branderhorst@xs4all.nl
 */
public class FigGeneralization extends FigEdgeModelElement {

    private static final int TEXT_HEIGHT = 20;

    private static final int DISCRIMINATOR_WIDTH = 90;

    /*
     * The serialVersionUID (generated by Eclipse)
     */
    private static final long serialVersionUID = 3983170503390943894L;


    /**
     * Group for the FigTexts concerning the name and stereotype of the
     * association itself.
     */
    private FigTextGroup middleGroup;
    
    /**
     * Text box for discriminator.
     */
    private FigText discriminator;

    private ArrowHeadTriangle endArrow;

    private void initialize() {
        // UML spec for Generalizations doesn't call for name

<span class="fc" id="L86">	discriminator.setFilled(false);</span>
<span class="fc" id="L87">	discriminator.setLineWidth(0);</span>
<span class="fc" id="L88">	discriminator.setReturnAction(FigText.END_EDITING);</span>
<span class="fc" id="L89">	discriminator.setTabAction(FigText.END_EDITING);</span>
	
<span class="fc" id="L91">        middleGroup.addFig(discriminator);</span>
<span class="fc" id="L92">        middleGroup.addFig(getStereotypeFig());        </span>
	
<span class="fc" id="L94">	addPathItem(middleGroup, </span>
	        new PathItemPlacement(this, middleGroup, 50, -10));

<span class="fc" id="L97">        endArrow = new ArrowHeadTriangle();</span>
<span class="fc" id="L98">	endArrow.setFillColor(FILL_COLOR);</span>
<span class="fc" id="L99">	setDestArrowHead(endArrow);</span>
	
<span class="fc" id="L101">	setBetweenNearestPoints(true);</span>
<span class="fc" id="L102">    }</span>

    /**
     * Construct a new generalization edge with the given model element as the
     * owner.
     * 
     * @param owner owning model element
     * @param settings render settings
     */
    public FigGeneralization(Object owner, DiagramSettings settings) {
<span class="fc" id="L112">        super(owner, settings);</span>
<span class="fc" id="L113">        discriminator = new ArgoFigText(owner, new Rectangle(X0, Y0,</span>
                DISCRIMINATOR_WIDTH, TEXT_HEIGHT), settings, false);
<span class="fc" id="L115">        middleGroup = new FigTextGroup(owner, settings);</span>
        
        
<span class="fc" id="L118">        initialize();</span>
<span class="fc" id="L119">        fixup(owner);</span>
<span class="fc" id="L120">        addListener(owner);</span>
<span class="fc" id="L121">    }</span>

    /*
     * @see org.argouml.uml.diagram.ui.FigEdgeModelElement#canEdit(org.tigris.gef.presentation.Fig)
     */
    @Override
    protected boolean canEdit(Fig f) {
<span class="nc" id="L128">        return false;</span>
    }

    /*
     * @see org.argouml.uml.diagram.ui.FigEdgeModelElement#modelChanged(java.beans.PropertyChangeEvent)
     */
    @Override
    protected void modelChanged(PropertyChangeEvent e) {
        // Name &amp; stereotypes get updated by superclass
<span class="nc" id="L137">        super.modelChanged(e);</span>
        // Update the discriminator if it changed
<span class="nc bnc" id="L139" title="All 2 branches missed.">        if (e instanceof AttributeChangeEvent</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">                &amp;&amp; &quot;discriminator&quot;.equals(e.getPropertyName())) {</span>
<span class="nc" id="L141">            updateDiscriminatorText();</span>
        }
<span class="nc" id="L143">    }</span>

    /*
     * @see org.argouml.uml.diagram.ui.FigEdgeModelElement#updateListeners(java.lang.Object, java.lang.Object)
     */
    @Override
    protected void updateListeners(Object oldOwner, Object newOwner) {
<span class="nc bnc" id="L150" title="All 2 branches missed.">        if (oldOwner != null) {</span>
<span class="nc" id="L151">            removeElementListener(oldOwner);</span>
        }
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if (newOwner != null) {</span>
<span class="nc" id="L154">            addListener(newOwner);</span>
        }
<span class="nc" id="L156">    }</span>

    private void addListener(Object owner) {
<span class="fc" id="L159">        addElementListener(owner, new String[] {&quot;remove&quot;, &quot;discriminator&quot;});</span>
<span class="fc" id="L160">    }</span>

    /**
     * Updates the discriminator text. Called if the model is changed
     * and on construction time.
     */
    public void updateDiscriminatorText() {
<span class="fc" id="L167">  	Object generalization = getOwner();</span>
<span class="pc bpc" id="L168" title="1 of 2 branches missed.">  	if (generalization == null) {</span>
<span class="nc" id="L169">	    return;</span>
  	}
  	String disc = 
<span class="fc" id="L172">            (String) Model.getFacade().getDiscriminator(generalization);</span>
<span class="fc bfc" id="L173" title="All 2 branches covered.">  	if (disc == null) {</span>
<span class="fc" id="L174">	    disc = &quot;&quot;;</span>
  	}
<span class="fc" id="L176">  	discriminator.setFont(getSettings().getFont(Font.PLAIN));</span>
<span class="fc" id="L177">  	discriminator.setText(disc);</span>
<span class="fc" id="L178">    }</span>

    /*
     * @see org.tigris.gef.presentation.Fig#paint(java.awt.Graphics)
     */
    @Override
    public void paint(Graphics g) {
<span class="nc" id="L185">        endArrow.setLineColor(getLineColor());</span>
<span class="nc" id="L186">        super.paint(g);</span>
<span class="nc" id="L187">    }</span>

    /**
     * Fix up bad figs.
     * &lt;p&gt;
     * Due to errors in earlier releases of argouml it can happen that there is
     * a generalization without a child or parent.
     * &lt;p&gt;
     * TODO: Move into XSL. We should not remove from the graph model while
     * we're writing to it or we have a possible cause of concurrent
     * modification exception.
     * 
     * @param owner
     */
    private void fixup(Object owner) {
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">        if (Model.getFacade().isAGeneralization(owner)) {</span>
<span class="fc" id="L203">            Object subType = Model.getFacade().getSpecific(owner);</span>
<span class="fc" id="L204">            Object superType = Model.getFacade().getGeneral(owner);</span>

<span class="pc bpc" id="L206" title="2 of 4 branches missed.">            if (subType == null || superType == null) {</span>
                // TODO: We should warn the user we have removed something - tfm
<span class="nc" id="L208">                removeFromDiagram();</span>
<span class="nc" id="L209">        	return;</span>
            }
<span class="fc" id="L211">            updateDiscriminatorText(); // show it</span>
<span class="pc bnc" id="L212" title="All 2 branches missed.">        } else if (owner != null) {</span>
<span class="nc" id="L213">            throw new IllegalStateException(</span>
                    &quot;FigGeneralization has an illegal owner of &quot;
<span class="nc" id="L215">                    + owner.getClass().getName());</span>
        }
<span class="fc" id="L217">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>