<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProjectSettingsTabProfile.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argouml-app</a> &gt; <a href="index.source.html" class="el_package">org.argouml.ui</a> &gt; <span class="el_source">ProjectSettingsTabProfile.java</span></div><h1>ProjectSettingsTabProfile.java</h1><pre class="source lang-java linenums">/* $Id$
 *****************************************************************************
 * Copyright (c) 2007-2010 Contributors - see below
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Marcos Aurelio - design and initial implementation
 *    thn
 *    euluis
 *****************************************************************************
 *
 * Some portions of this file was previously release using the BSD License:
 */

// Copyright (c) 2007-2009 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies. This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied &quot;AS
// IS&quot;, without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason. IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package org.argouml.ui;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.io.File;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

import javax.swing.BoxLayout;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFileChooser;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.MutableComboBoxModel;
import javax.swing.filechooser.FileFilter;

import org.argouml.i18n.Translator;
import org.argouml.kernel.ProfileConfiguration;
import org.argouml.kernel.Project;
import org.argouml.kernel.ProjectSettings;
import org.argouml.profile.Profile;
import org.argouml.profile.ProfileException;
import org.argouml.profile.ProfileFacade;
import org.argouml.profile.UserDefinedProfile;
import org.argouml.uml.diagram.DiagramAppearance;
import org.argouml.uml.diagram.DiagramSettings;

/**
 * The Tab where new profiles can be added and the registered ones can be
 * activated or deactivated on current project
 * 
 * @author Marcos Aurelio
 */
<span class="nc bnc" id="L85" title="All 2 branches missed.">public class ProjectSettingsTabProfile extends JPanel implements</span>
        GUIProjectSettingsTabInterface, ActionListener {

    private Project p;

    private JButton loadFromFile;

    private JButton unregisterProfile;

    private JButton addButton;

    private JButton removeButton;

    private JList availableList;

    private JList usedList;

    // //////

<span class="nc" id="L104">    private JLabel stereoLabel = new JLabel(Translator</span>
<span class="nc" id="L105">            .localize(&quot;menu.popup.stereotype-view&quot;)</span>
            + &quot;: &quot;);

<span class="nc" id="L108">    private JComboBox stereoField = new JComboBox();</span>

    private JFileChooser fileChooser;

<span class="nc" id="L112">    private boolean initialized = false;</span>
    
    /**
     * The default constructor for this class
     */
<span class="nc" id="L117">    public ProjectSettingsTabProfile() {</span>
        // Defer all work until we're actually needed
<span class="nc" id="L119">    }</span>

    private void buildDialog() {
<span class="nc" id="L122">        setLayout(new BoxLayout(this, BoxLayout.Y_AXIS));</span>

        // ////////////

<span class="nc" id="L126">        JPanel setDefStereoV = new JPanel();</span>
<span class="nc" id="L127">        setDefStereoV.setLayout(new FlowLayout());</span>

<span class="nc" id="L129">        stereoLabel.setLabelFor(stereoField);</span>
<span class="nc" id="L130">        setDefStereoV.add(stereoLabel);</span>
<span class="nc" id="L131">        setDefStereoV.add(stereoField);</span>

<span class="nc" id="L133">        DefaultComboBoxModel cmodel = new DefaultComboBoxModel();</span>
<span class="nc" id="L134">        stereoField.setModel(cmodel);</span>

<span class="nc" id="L136">        cmodel.addElement(Translator</span>
<span class="nc" id="L137">                .localize(&quot;menu.popup.stereotype-view.textual&quot;));</span>
<span class="nc" id="L138">        cmodel.addElement(Translator</span>
<span class="nc" id="L139">                .localize(&quot;menu.popup.stereotype-view.big-icon&quot;));</span>
<span class="nc" id="L140">        cmodel.addElement(Translator</span>
<span class="nc" id="L141">                .localize(&quot;menu.popup.stereotype-view.small-icon&quot;));</span>

<span class="nc" id="L143">        stereoField.addItemListener(new ItemListener() {</span>

            public void itemStateChanged(ItemEvent e) {
<span class="nc bnc" id="L146" title="All 2 branches missed.">                if (p == null) {</span>
<span class="nc" id="L147">                    return;</span>
                }
<span class="nc" id="L149">                ProjectSettings ps = p.getProjectSettings();</span>
<span class="nc" id="L150">                DiagramSettings ds = ps.getDefaultDiagramSettings();</span>
<span class="nc" id="L151">                Object src = e.getSource();</span>

<span class="nc bnc" id="L153" title="All 2 branches missed.">                if (src == stereoField) {</span>
<span class="nc" id="L154">                    Object item = e.getItem();</span>
<span class="nc" id="L155">                    DefaultComboBoxModel model = </span>
<span class="nc" id="L156">                        (DefaultComboBoxModel) stereoField.getModel();</span>
<span class="nc" id="L157">                    int idx = model.getIndexOf(item);</span>

<span class="nc bnc" id="L159" title="All 4 branches missed.">                    switch (idx) {</span>
                    case 0:
<span class="nc" id="L161">                        ds.setDefaultStereotypeView(</span>
                                DiagramAppearance.STEREOTYPE_VIEW_TEXTUAL);
<span class="nc" id="L163">                        break;</span>
                    case 1:
<span class="nc" id="L165">                        ds.setDefaultStereotypeView(</span>
                                DiagramAppearance.STEREOTYPE_VIEW_BIG_ICON);
<span class="nc" id="L167">                        break;</span>
                    case 2:
<span class="nc" id="L169">                        ds.setDefaultStereotypeView(</span>
                                DiagramAppearance.STEREOTYPE_VIEW_SMALL_ICON);
                        break;
                    }
                }
<span class="nc" id="L174">            }</span>

        });

<span class="nc" id="L178">        add(setDefStereoV);</span>

        // //////////

<span class="nc" id="L182">        JPanel configPanel = new JPanel();</span>
<span class="nc" id="L183">        configPanel.setLayout(new BoxLayout(configPanel, BoxLayout.X_AXIS));</span>

<span class="nc" id="L185">        availableList = createProfileList();</span>
<span class="nc" id="L186">        usedList = createProfileList();</span>

<span class="nc" id="L188">        JPanel leftList = new JPanel();</span>
<span class="nc" id="L189">        leftList.setLayout(new BorderLayout());</span>
<span class="nc" id="L190">        leftList.add(new JLabel(Translator</span>
<span class="nc" id="L191">                .localize(&quot;tab.profiles.userdefined.available&quot;)),</span>
                BorderLayout.NORTH);
<span class="nc" id="L193">        leftList.add(new JScrollPane(availableList), BorderLayout.CENTER);</span>
<span class="nc" id="L194">        configPanel.add(leftList);</span>

<span class="nc" id="L196">        JPanel centerButtons = new JPanel();</span>
<span class="nc" id="L197">        centerButtons.setLayout(new BoxLayout(centerButtons, BoxLayout.Y_AXIS));</span>

<span class="nc" id="L199">        addButton = new JButton(&quot;&gt;&gt;&quot;);</span>
<span class="nc" id="L200">        centerButtons.add(addButton);</span>
<span class="nc" id="L201">        removeButton = new JButton(&quot;&lt;&lt;&quot;);</span>
<span class="nc" id="L202">        centerButtons.add(removeButton);</span>
<span class="nc" id="L203">        configPanel.add(centerButtons);</span>

<span class="nc" id="L205">        JPanel rightList = new JPanel();</span>
<span class="nc" id="L206">        rightList.setLayout(new BorderLayout());</span>
<span class="nc" id="L207">        rightList.add(new JLabel(Translator</span>
<span class="nc" id="L208">                .localize(&quot;tab.profiles.userdefined.active&quot;)),</span>
                BorderLayout.NORTH);
<span class="nc" id="L210">        rightList.add(new JScrollPane(usedList), BorderLayout.CENTER);</span>
<span class="nc" id="L211">        configPanel.add(rightList);</span>


<span class="nc" id="L214">        addButton.addActionListener(this);</span>
<span class="nc" id="L215">        removeButton.addActionListener(this);</span>

<span class="nc" id="L217">        add(configPanel);</span>

<span class="nc" id="L219">        JPanel lffPanel = new JPanel();</span>
<span class="nc" id="L220">        lffPanel.setLayout(new FlowLayout());</span>

<span class="nc" id="L222">        loadFromFile = new JButton(Translator</span>
<span class="nc" id="L223">                .localize(&quot;tab.profiles.userdefined.load&quot;));</span>
<span class="nc" id="L224">        loadFromFile.addActionListener(this);</span>
<span class="nc" id="L225">        lffPanel.add(loadFromFile);</span>

<span class="nc" id="L227">        unregisterProfile = new JButton(Translator</span>
<span class="nc" id="L228">                .localize(&quot;tab.profiles.userdefined.unload&quot;));</span>
<span class="nc" id="L229">        unregisterProfile.addActionListener(this);</span>
<span class="nc" id="L230">        lffPanel.add(unregisterProfile);</span>

<span class="nc" id="L232">        add(lffPanel);</span>
        
<span class="nc" id="L234">        initialized = true;</span>
<span class="nc" id="L235">    }</span>
    
   
    @Override
    public void setVisible(boolean flag) {
<span class="nc bnc" id="L240" title="All 4 branches missed.">        if (flag &amp;&amp; !initialized) {</span>
<span class="nc" id="L241">            buildDialog();</span>
        }
<span class="nc" id="L243">        super.setVisible(flag);</span>
<span class="nc" id="L244">    }</span>
    
    private JList createProfileList() {
<span class="nc" id="L247">        JList list = new JList();</span>
<span class="nc" id="L248">        list.setMinimumSize(new Dimension(50, 50));</span>
        // TODO: Add double click listener 
<span class="nc" id="L250">        return list;</span>
    }
    private void refreshLists() {
<span class="nc" id="L253">        availableList.setModel(new DefaultComboBoxModel(getAvailableProfiles()</span>
<span class="nc" id="L254">                .toArray()));</span>
<span class="nc" id="L255">        usedList.setModel(</span>
<span class="nc" id="L256">                new DefaultComboBoxModel(getUsedProfiles().toArray()));</span>
<span class="nc" id="L257">    }</span>

    private List&lt;Profile&gt; getUsedProfiles() {
<span class="nc" id="L260">        return new ArrayList&lt;Profile&gt;(</span>
<span class="nc" id="L261">                p.getProfileConfiguration().getProfiles());</span>
    }

    private List&lt;Profile&gt; getAvailableProfiles() {
<span class="nc" id="L265">        List&lt;Profile&gt; used = getUsedProfiles();</span>
<span class="nc" id="L266">        List&lt;Profile&gt; ret = new ArrayList&lt;Profile&gt;();</span>

<span class="nc bnc" id="L268" title="All 2 branches missed.">        for (Profile profile : ProfileFacade.getManager()</span>
<span class="nc" id="L269">                .getRegisteredProfiles()) {</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">            if (!used.contains(profile)) {</span>
<span class="nc" id="L271">                ret.add(profile);</span>
            }
<span class="nc" id="L273">        }</span>

<span class="nc" id="L275">        return ret;</span>
    }

    /*
     * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
     */
    public void actionPerformed(ActionEvent arg0) {
<span class="nc" id="L282">        MutableComboBoxModel modelAvailable = </span>
<span class="nc" id="L283">            ((MutableComboBoxModel) availableList.getModel());</span>
<span class="nc" id="L284">        MutableComboBoxModel modelUsed = </span>
<span class="nc" id="L285">            ((MutableComboBoxModel) usedList.getModel());</span>

<span class="nc bnc" id="L287" title="All 2 branches missed.">        if (arg0.getSource() == addButton) {</span>
<span class="nc" id="L288">            Object[] selections = availableList.getSelectedValues();</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">            for (Object s : selections) {</span>
<span class="nc" id="L290">                Profile selected = (Profile) s;</span>
<span class="nc" id="L291">                modelUsed.addElement(selected);</span>
<span class="nc" id="L292">                modelAvailable.removeElement(selected);</span>

<span class="nc bnc" id="L294" title="All 2 branches missed.">                for (Profile profile : getAvailableDependents(selected)) {</span>
<span class="nc" id="L295">                    modelUsed.addElement(profile);</span>
<span class="nc" id="L296">                    modelAvailable.removeElement(profile);</span>
<span class="nc" id="L297">                }</span>
            }
<span class="nc bnc" id="L299" title="All 2 branches missed.">        } else if (arg0.getSource() == removeButton) {</span>
<span class="nc" id="L300">            Object[] selections = usedList.getSelectedValues();</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">            for (Object s : selections) {</span>
<span class="nc" id="L302">                Profile selected = (Profile) s;</span>
<span class="nc" id="L303">                Collection&lt;Profile&gt; dependents = getActiveDependents(selected);</span>
<span class="nc" id="L304">                boolean remove = true;</span>

<span class="nc bnc" id="L306" title="All 2 branches missed.">                if (!dependents.isEmpty()) {</span>
<span class="nc" id="L307">                    String message = Translator.localize(</span>
                            &quot;tab.profiles.confirmdeletewithdependencies&quot;,
                            new Object[] {dependents});
<span class="nc" id="L310">                    String title = Translator.localize(</span>
                            &quot;tab.profiles.confirmdeletewithdependencies.title&quot;);
<span class="nc bnc" id="L312" title="All 2 branches missed.">                    remove = (JOptionPane.showConfirmDialog(</span>
                            this, message, title, JOptionPane.YES_NO_OPTION) 
                            == JOptionPane.YES_OPTION);
                }

<span class="nc bnc" id="L317" title="All 2 branches missed.">                if (remove) {</span>
<span class="nc" id="L318">                    if (!ProfileFacade.getManager().getRegisteredProfiles()</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">                            .contains(selected)</span>
<span class="nc" id="L320">                            &amp;&amp; !ProfileFacade.getManager().getDefaultProfiles()</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">                                    .contains(selected)) {</span>
<span class="nc" id="L322">                        remove = (JOptionPane</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">                                .showConfirmDialog(</span>
                                        this,
<span class="nc" id="L325">                                        Translator.localize(</span>
                                 &quot;tab.profiles.confirmdeleteunregistered&quot;),
<span class="nc" id="L327">                                        Translator.localize(</span>
                                &quot;tab.profiles.confirmdeleteunregistered.title&quot;),
                                        JOptionPane.YES_NO_OPTION) 
                                        == JOptionPane.YES_OPTION);
                    }

<span class="nc bnc" id="L333" title="All 2 branches missed.">                    if (remove) {</span>
<span class="nc" id="L334">                        modelUsed.removeElement(selected);</span>
<span class="nc" id="L335">                        modelAvailable.addElement(selected);</span>

<span class="nc bnc" id="L337" title="All 2 branches missed.">                        for (Profile profile : dependents) {</span>
<span class="nc" id="L338">                            modelUsed.removeElement(profile);</span>
<span class="nc" id="L339">                            modelAvailable.addElement(profile);</span>
<span class="nc" id="L340">                        }</span>
                    }
                }
            }
<span class="nc bnc" id="L344" title="All 2 branches missed.">        } else if (arg0.getSource() == unregisterProfile) {</span>
<span class="nc" id="L345">            Object[] selections = availableList.getSelectedValues();</span>
<span class="nc bnc" id="L346" title="All 2 branches missed.">            for (Object s : selections) {</span>
<span class="nc" id="L347">                Profile selected = (Profile) s;</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">                if (selected instanceof UserDefinedProfile) {</span>
<span class="nc" id="L349">                    ProfileFacade.getManager().removeProfile(selected);</span>
<span class="nc" id="L350">                    modelAvailable.removeElement(selected);</span>
                } else {
<span class="nc" id="L352">                    JOptionPane.showMessageDialog(this, Translator</span>
<span class="nc" id="L353">                            .localize(&quot;tab.profiles.cannotdelete&quot;));</span>
                }
            }
<span class="nc bnc" id="L356" title="All 2 branches missed.">        } else if (arg0.getSource() == loadFromFile) {</span>
<span class="nc" id="L357">            JFileChooser chooser = getFileChooser();</span>

<span class="nc" id="L359">            int ret = chooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">            if (ret == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L361">                File file = chooser.getSelectedFile();</span>
<span class="nc" id="L362">                chooser.setCurrentDirectory(file.getParentFile());</span>
                try {
<span class="nc" id="L364">                    UserDefinedProfile profile = new UserDefinedProfile(file,</span>
<span class="nc" id="L365">                        ProfileFacade.getManager());</span>
<span class="nc" id="L366">                    ProfileFacade.getManager().registerProfile(profile);</span>

<span class="nc" id="L368">                    modelAvailable.addElement(profile);</span>
<span class="nc" id="L369">                } catch (ProfileException e) {</span>
<span class="nc" id="L370">                    JOptionPane.showMessageDialog(this, Translator</span>
<span class="nc" id="L371">                            .localize(&quot;tab.profiles.userdefined.errorloading&quot;));</span>
<span class="nc" id="L372">                }</span>
            }
        }

<span class="nc" id="L376">        availableList.validate();</span>
<span class="nc" id="L377">        usedList.validate();</span>
<span class="nc" id="L378">    }</span>

    private JFileChooser getFileChooser() {
<span class="nc bnc" id="L381" title="All 2 branches missed.">        if (fileChooser == null) {</span>
<span class="nc" id="L382">            fileChooser = new JFileChooser();</span>
<span class="nc" id="L383">            fileChooser.setFileFilter(new ProfileFileFilter());</span>
        }
<span class="nc" id="L385">        return fileChooser;</span>
    }

    private List&lt;Profile&gt; getAvailableDependents(Profile selected) {
<span class="nc" id="L389">        MutableComboBoxModel modelAvl = ((MutableComboBoxModel) availableList</span>
<span class="nc" id="L390">                .getModel());</span>

<span class="nc" id="L392">        List&lt;Profile&gt; ret = new ArrayList&lt;Profile&gt;();</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">        for (int i = 0; i &lt; modelAvl.getSize(); ++i) {</span>
<span class="nc" id="L394">            Profile profile = (Profile) modelAvl.getElementAt(i);</span>

<span class="nc bnc" id="L396" title="All 2 branches missed.">            if (!profile.equals(selected) </span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">                    &amp;&amp; selected.getDependencies().contains(profile)) {</span>
<span class="nc" id="L398">                ret.add(profile);</span>
            }
        }

<span class="nc" id="L402">        return ret;</span>
    }

    private List&lt;Profile&gt; getActiveDependents(Profile selected) {
<span class="nc" id="L406">        MutableComboBoxModel modelUsd = ((MutableComboBoxModel) usedList</span>
<span class="nc" id="L407">                .getModel());</span>

<span class="nc" id="L409">        List&lt;Profile&gt; ret = new ArrayList&lt;Profile&gt;();</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">        for (int i = 0; i &lt; modelUsd.getSize(); ++i) {</span>
<span class="nc" id="L411">            Profile profile = (Profile) modelUsd.getElementAt(i);</span>

<span class="nc bnc" id="L413" title="All 2 branches missed.">            if (!profile.equals(selected) </span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">                    &amp;&amp; profile.getDependencies().contains(selected)) {</span>
<span class="nc" id="L415">                ret.add(profile);</span>
            }
        }

<span class="nc" id="L419">        return ret;</span>
    }

    /**
     * @return the internationalization key that containing the name of this tab
     * @see org.argouml.application.api.GUISettingsTabInterface#getTabKey()
     */
    public String getTabKey() {
<span class="nc" id="L427">        return &quot;tab.profiles&quot;;</span>
    }

    /**
     * @return the panel containing this tab
     * @see org.argouml.application.api.GUISettingsTabInterface#getTabPanel()
     */
    public JPanel getTabPanel() {
<span class="nc bnc" id="L435" title="All 2 branches missed.">        if (!initialized) {</span>
<span class="nc" id="L436">            buildDialog();</span>
        }
<span class="nc" id="L438">        return this;</span>
    }

    public void handleResetToDefault() {
<span class="nc bnc" id="L442" title="All 2 branches missed.">        if (!initialized) {</span>
<span class="nc" id="L443">            buildDialog();</span>
        }
<span class="nc" id="L445">        refreshLists();</span>
<span class="nc" id="L446">    }</span>

    public void handleSettingsTabCancel() {

<span class="nc" id="L450">    }</span>

    public void handleSettingsTabRefresh() {
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (!initialized) {</span>
<span class="nc" id="L454">            buildDialog();</span>
        }
<span class="nc bnc" id="L456" title="All 4 branches missed.">        assert p != null;</span>
<span class="nc" id="L457">        ProjectSettings ps = p.getProjectSettings();</span>
<span class="nc" id="L458">        DiagramSettings ds = ps.getDefaultDiagramSettings();</span>
        
<span class="nc bnc" id="L460" title="All 4 branches missed.">        switch (ds.getDefaultStereotypeViewInt()) {</span>
        case DiagramAppearance.STEREOTYPE_VIEW_TEXTUAL:
<span class="nc" id="L462">            stereoField.setSelectedIndex(0);</span>
<span class="nc" id="L463">            break;</span>
        case DiagramAppearance.STEREOTYPE_VIEW_BIG_ICON:
<span class="nc" id="L465">            stereoField.setSelectedIndex(1);</span>
<span class="nc" id="L466">            break;</span>
        case DiagramAppearance.STEREOTYPE_VIEW_SMALL_ICON:
<span class="nc" id="L468">            stereoField.setSelectedIndex(2);</span>
            break;
        }

<span class="nc" id="L472">        refreshLists();</span>
<span class="nc" id="L473">    }</span>

    public void handleSettingsTabSave() {
<span class="nc bnc" id="L476" title="All 2 branches missed.">        if (!initialized) {</span>
<span class="nc" id="L477">            return;</span>
        }
<span class="nc bnc" id="L479" title="All 4 branches missed.">        assert p != null;</span>
<span class="nc" id="L480">        List&lt;Profile&gt; toRemove = new ArrayList&lt;Profile&gt;();</span>
<span class="nc" id="L481">        ProfileConfiguration pc = p.getProfileConfiguration();</span>
<span class="nc" id="L482">        Object m = p.getUserDefinedModelList().get(0);</span>

<span class="nc" id="L484">        List&lt;Profile&gt; usedItens = new ArrayList&lt;Profile&gt;();</span>

<span class="nc" id="L486">        MutableComboBoxModel modelUsd = ((MutableComboBoxModel) usedList</span>
<span class="nc" id="L487">                .getModel());</span>

<span class="nc bnc" id="L489" title="All 2 branches missed.">        for (int i = 0; i &lt; modelUsd.getSize(); ++i) {</span>
<span class="nc" id="L490">            usedItens.add((Profile) modelUsd.getElementAt(i));</span>
        }

<span class="nc bnc" id="L493" title="All 2 branches missed.">        for (Profile profile : pc.getProfiles()) {</span>
<span class="nc bnc" id="L494" title="All 2 branches missed.">            if (!usedItens.contains(profile)) {</span>
<span class="nc" id="L495">                toRemove.add(profile);</span>
            }
<span class="nc" id="L497">        }</span>

<span class="nc bnc" id="L499" title="All 2 branches missed.">        for (Profile profile : toRemove) {</span>
<span class="nc" id="L500">            pc.removeProfile(profile, m);</span>
<span class="nc" id="L501">        }</span>

<span class="nc bnc" id="L503" title="All 2 branches missed.">        for (Profile profile : usedItens) {</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">            if (!pc.getProfiles().contains(profile)) {</span>
<span class="nc" id="L505">                pc.addProfile(profile, m);</span>
            }
<span class="nc" id="L507">        }</span>

<span class="nc" id="L509">        p.setProfileConfiguration(pc);</span>
<span class="nc" id="L510">    }</span>

    public void setProject(Project project) {
<span class="nc bnc" id="L513" title="All 4 branches missed.">        assert project != null;</span>
<span class="nc" id="L514">        p = project;</span>
<span class="nc" id="L515">    }</span>
    
<span class="nc" id="L517">    private class ProfileFileFilter extends FileFilter {</span>
        public boolean accept(File file) {
<span class="nc bnc" id="L519" title="All 2 branches missed.">            if (file.isDirectory()) {</span>
<span class="nc" id="L520">                return true;</span>
            }
<span class="nc bnc" id="L522" title="All 2 branches missed.">            if (file.isFile()) {</span>
<span class="nc" id="L523">                String filename = file.getName().toLowerCase();</span>
<span class="nc" id="L524">                String[] validEndings = {&quot;.xmi&quot;, &quot;.xml&quot;, &quot;.xmi.zip&quot;, </span>
                                         &quot;.xml.zip&quot;};
<span class="nc bnc" id="L526" title="All 2 branches missed.">                for (String ending : validEndings) {</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">                    if (filename.endsWith(ending)) {</span>
<span class="nc" id="L528">                        return true;</span>
                    }
                }
            }
<span class="nc" id="L532">            return false;</span>
        }

        public String getDescription() {
<span class="nc" id="L536">            return &quot;*.xmi *.xml *.xmi.zip *.xml.zip&quot;;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>