<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SettingsTabProfile.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">argouml-app</a> &gt; <a href="index.source.html" class="el_package">org.argouml.ui</a> &gt; <span class="el_source">SettingsTabProfile.java</span></div><h1>SettingsTabProfile.java</h1><pre class="source lang-java linenums">/* $Id$
 *****************************************************************************
 * Copyright (c) 2007-2010 Contributors - see below
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Marcos Aurï¿½lio - Design and initial implementation
 *    thn
 *    euluis
 *****************************************************************************
 *
 * Some portions of this file was previously release using the BSD License:
 */

// Copyright (c) 2007-2009 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies. This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied &quot;AS
// IS&quot;, without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason. IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN &quot;AS IS&quot; BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package org.argouml.ui;

import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.io.File;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

import javax.swing.BoxLayout;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFileChooser;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.MutableComboBoxModel;
import javax.swing.filechooser.FileFilter;

import org.argouml.application.api.GUISettingsTabInterface;
import org.argouml.configuration.Configuration;
import org.argouml.i18n.Translator;
import org.argouml.kernel.ProfileConfiguration;
import org.argouml.model.Model;
import org.argouml.profile.Profile;
import org.argouml.profile.ProfileException;
import org.argouml.profile.ProfileFacade;
import org.argouml.profile.UserDefinedProfile;
import org.argouml.profile.UserDefinedProfileHelper;
import org.argouml.swingext.JLinkButton;
import org.argouml.uml.diagram.DiagramAppearance;

/**
 * The Tab containing the global settings for profiles
 * 
 * @author Marcos Aurï¿½lio
 */
public class SettingsTabProfile extends JPanel implements
        GUISettingsTabInterface, ActionListener {

    private JButton loadFromFile;

    private JButton addButton;

    private JButton removeButton;

    private JList availableList;

    private JList defaultList;

    // //////

    private JList directoryList;

    private JButton addDirectory;

    private JButton removeDirectory;

<span class="nc" id="L108">    private JButton refreshProfiles = new JButton(Translator</span>
<span class="nc" id="L109">            .localize(&quot;tab.profiles.directories.refresh&quot;));</span>

    // /////

    private JLabel stereoLabel;

    private JComboBox stereoField;

<span class="nc" id="L117">    private boolean initialized = false;</span>

    /**
     * Construct the Profile settings tab
     */
<span class="nc" id="L122">    public SettingsTabProfile() {</span>
<span class="nc" id="L123">    }</span>

    private void buildPanel() {
<span class="nc" id="L126">        setLayout(new BorderLayout());</span>

<span class="nc" id="L128">        JPanel warning = new JPanel();</span>
<span class="nc" id="L129">        warning.setLayout(new BoxLayout(warning, BoxLayout.PAGE_AXIS));</span>
<span class="nc" id="L130">        JLabel warningLabel = new JLabel(Translator.localize(&quot;label.warning&quot;));</span>
<span class="nc" id="L131">        warningLabel.setAlignmentX(Component.RIGHT_ALIGNMENT);</span>
<span class="nc" id="L132">        warning.add(warningLabel);</span>

<span class="nc" id="L134">        JLinkButton projectSettings = new JLinkButton();</span>
<span class="nc" id="L135">        projectSettings.setAction(new ActionProjectSettings());</span>
<span class="nc" id="L136">        projectSettings.setText(Translator.localize(&quot;button.project-settings&quot;));</span>
<span class="nc" id="L137">        projectSettings.setIcon(null);</span>
<span class="nc" id="L138">        projectSettings.setAlignmentX(Component.RIGHT_ALIGNMENT);</span>
<span class="nc" id="L139">        warning.add(projectSettings);</span>

<span class="nc" id="L141">        add(warning, BorderLayout.NORTH);</span>

<span class="nc" id="L143">        JPanel profileSettings = new JPanel();</span>
<span class="nc" id="L144">        profileSettings.setLayout(new BoxLayout(profileSettings,</span>
                BoxLayout.Y_AXIS));

<span class="nc" id="L147">        profileSettings.add(initDefaultStereotypeViewSelector());</span>

<span class="nc" id="L149">        JPanel sdirPanel = new JPanel();</span>
<span class="nc" id="L150">        sdirPanel.setLayout(new BoxLayout(sdirPanel, BoxLayout.Y_AXIS));</span>


<span class="nc" id="L153">        JPanel lcb = new JPanel();</span>
<span class="nc" id="L154">        lcb.setLayout(new BoxLayout(lcb, BoxLayout.Y_AXIS));</span>

<span class="nc" id="L156">        addDirectory = new JButton(Translator</span>
<span class="nc" id="L157">                .localize(&quot;tab.profiles.directories.add&quot;));</span>
<span class="nc" id="L158">        removeDirectory = new JButton(Translator</span>
<span class="nc" id="L159">                .localize(&quot;tab.profiles.directories.remove&quot;));</span>
        
<span class="nc" id="L161">        lcb.add(addDirectory);</span>
<span class="nc" id="L162">        lcb.add(removeDirectory);</span>

<span class="nc" id="L164">        addDirectory.addActionListener(this);</span>
<span class="nc" id="L165">        removeDirectory.addActionListener(this);</span>

<span class="nc" id="L167">        directoryList = new JList();</span>
<span class="nc" id="L168">        directoryList.setMinimumSize(new Dimension(50, 50));</span>

<span class="nc" id="L170">        JPanel dlist = new JPanel();</span>
<span class="nc" id="L171">        dlist.setLayout(new BorderLayout());        </span>
<span class="nc" id="L172">        dlist.add(new JScrollPane(directoryList), BorderLayout.CENTER);</span>
<span class="nc" id="L173">        dlist.add(lcb, BorderLayout.EAST);</span>

<span class="nc" id="L175">        sdirPanel.add(new JLabel(Translator</span>
<span class="nc" id="L176">                .localize(&quot;tab.profiles.directories.desc&quot;)));</span>
<span class="nc" id="L177">        sdirPanel.add(dlist);</span>

<span class="nc" id="L179">        profileSettings.add(sdirPanel);</span>

<span class="nc" id="L181">        JPanel configPanel = new JPanel();</span>
<span class="nc" id="L182">        configPanel.setLayout(new BoxLayout(configPanel, BoxLayout.X_AXIS));</span>

<span class="nc" id="L184">        availableList = createProfileList();</span>
<span class="nc" id="L185">        defaultList = createProfileList();</span>

<span class="nc" id="L187">        refreshLists();</span>

<span class="nc" id="L189">        JPanel leftList = new JPanel();</span>
<span class="nc" id="L190">        leftList.setLayout(new BorderLayout());</span>
<span class="nc" id="L191">        leftList.add(new JLabel(Translator</span>
<span class="nc" id="L192">                .localize(&quot;tab.profiles.userdefined.available&quot;)),</span>
                BorderLayout.NORTH);
<span class="nc" id="L194">        leftList.add(new JScrollPane(availableList), BorderLayout.CENTER);</span>
<span class="nc" id="L195">        configPanel.add(leftList);</span>

<span class="nc" id="L197">        JPanel centerButtons = new JPanel();</span>
<span class="nc" id="L198">        centerButtons.setLayout(new BoxLayout(centerButtons, BoxLayout.Y_AXIS));</span>
<span class="nc" id="L199">        addButton = new JButton(&quot;&gt;&gt;&quot;);</span>
<span class="nc" id="L200">        removeButton = new JButton(&quot;&lt;&lt;&quot;);</span>
<span class="nc" id="L201">        centerButtons.add(addButton);</span>
<span class="nc" id="L202">        centerButtons.add(removeButton);</span>
<span class="nc" id="L203">        configPanel.add(centerButtons);</span>

<span class="nc" id="L205">        JPanel rightList = new JPanel();</span>
<span class="nc" id="L206">        rightList.setLayout(new BorderLayout());</span>
<span class="nc" id="L207">        rightList.add(new JLabel(Translator</span>
<span class="nc" id="L208">                .localize(&quot;tab.profiles.userdefined.default&quot;)),</span>
                BorderLayout.NORTH);

<span class="nc" id="L211">        rightList.add(new JScrollPane(defaultList), BorderLayout.CENTER);</span>
<span class="nc" id="L212">        configPanel.add(rightList);</span>

<span class="nc" id="L214">        addButton.addActionListener(this);</span>
<span class="nc" id="L215">        removeButton.addActionListener(this);</span>

<span class="nc" id="L217">        profileSettings.add(configPanel);</span>

<span class="nc" id="L219">        JPanel lffPanel = new JPanel();</span>
<span class="nc" id="L220">        lffPanel.setLayout(new FlowLayout());</span>
<span class="nc" id="L221">        loadFromFile = new JButton(Translator</span>
<span class="nc" id="L222">                .localize(&quot;tab.profiles.userdefined.load&quot;));</span>
<span class="nc" id="L223">        lffPanel.add(loadFromFile);</span>
<span class="nc" id="L224">        lffPanel.add(refreshProfiles);</span>

<span class="nc" id="L226">        loadFromFile.addActionListener(this);</span>
<span class="nc" id="L227">        refreshProfiles.addActionListener(this);</span>

<span class="nc" id="L229">        profileSettings.add(lffPanel);</span>

<span class="nc" id="L231">        add(profileSettings, BorderLayout.CENTER);</span>

<span class="nc" id="L233">        initialized = true;</span>
<span class="nc" id="L234">    }</span>

    
    @Override
    public void setVisible(boolean flag) {
<span class="nc bnc" id="L239" title="All 4 branches missed.">        if (flag &amp;&amp; !initialized) {</span>
<span class="nc" id="L240">            buildPanel();</span>
        }
<span class="nc" id="L242">        super.setVisible(flag);</span>
<span class="nc" id="L243">    }</span>
    
    private JList createProfileList() {
<span class="nc" id="L246">        JList list = new JList();</span>
<span class="nc" id="L247">        list.setMinimumSize(new Dimension(50, 50));</span>
<span class="nc" id="L248">        return list;</span>
    }

    private JPanel initDefaultStereotypeViewSelector() {
<span class="nc" id="L252">        JPanel setDefStereoV = new JPanel();</span>
<span class="nc" id="L253">        setDefStereoV.setLayout(new FlowLayout());</span>
<span class="nc" id="L254">        stereoField = new JComboBox();</span>
<span class="nc" id="L255">        stereoLabel = new JLabel(Translator</span>
<span class="nc" id="L256">                .localize(&quot;menu.popup.stereotype-view&quot;)</span>
                + &quot;: &quot;);
<span class="nc" id="L258">        stereoLabel.setLabelFor(stereoField);</span>
<span class="nc" id="L259">        setDefStereoV.add(stereoLabel);</span>
<span class="nc" id="L260">        setDefStereoV.add(stereoField);</span>

<span class="nc" id="L262">        DefaultComboBoxModel cmodel = new DefaultComboBoxModel();</span>
<span class="nc" id="L263">        stereoField.setModel(cmodel);</span>

<span class="nc" id="L265">        cmodel.addElement(Translator</span>
<span class="nc" id="L266">                .localize(&quot;menu.popup.stereotype-view.textual&quot;));</span>
<span class="nc" id="L267">        cmodel.addElement(Translator</span>
<span class="nc" id="L268">                .localize(&quot;menu.popup.stereotype-view.big-icon&quot;));</span>
<span class="nc" id="L269">        cmodel.addElement(Translator</span>
<span class="nc" id="L270">                .localize(&quot;menu.popup.stereotype-view.small-icon&quot;));</span>

<span class="nc" id="L272">        stereoField.addItemListener(new ItemListener() {</span>

            public void itemStateChanged(ItemEvent e) {
<span class="nc" id="L275">                Object src = e.getSource();</span>

<span class="nc bnc" id="L277" title="All 2 branches missed.">                if (src == stereoField) {</span>
<span class="nc" id="L278">                    Object item = e.getItem();</span>
<span class="nc" id="L279">                    DefaultComboBoxModel model = </span>
<span class="nc" id="L280">                        (DefaultComboBoxModel) stereoField.getModel();</span>
<span class="nc" id="L281">                    int idx = model.getIndexOf(item);</span>

<span class="nc bnc" id="L283" title="All 4 branches missed.">                    switch (idx) {</span>
                    case 0:
<span class="nc" id="L285">                        Configuration</span>
<span class="nc" id="L286">                                .setInteger(</span>
                                        ProfileConfiguration.KEY_DEFAULT_STEREOTYPE_VIEW,
                                        DiagramAppearance.STEREOTYPE_VIEW_TEXTUAL);
<span class="nc" id="L289">                        break;</span>
                    case 1:
<span class="nc" id="L291">                        Configuration</span>
<span class="nc" id="L292">                                .setInteger(</span>
                                        ProfileConfiguration.KEY_DEFAULT_STEREOTYPE_VIEW,
                                        DiagramAppearance.STEREOTYPE_VIEW_BIG_ICON);
<span class="nc" id="L295">                        break;</span>
                    case 2:
<span class="nc" id="L297">                        Configuration</span>
<span class="nc" id="L298">                                .setInteger(</span>
                                        ProfileConfiguration.KEY_DEFAULT_STEREOTYPE_VIEW,
                                        DiagramAppearance.STEREOTYPE_VIEW_SMALL_ICON);
                        break;
                    }
                }
<span class="nc" id="L304">            }</span>

        });
<span class="nc" id="L307">        return setDefStereoV;</span>
    }

    private void refreshLists() {
<span class="nc" id="L311">        availableList.setModel(new DefaultComboBoxModel(getAvailableProfiles()</span>
<span class="nc" id="L312">                .toArray()));</span>
<span class="nc" id="L313">        defaultList.setModel(new DefaultComboBoxModel(getUsedProfiles()</span>
<span class="nc" id="L314">                .toArray()));</span>
<span class="nc" id="L315">        directoryList.setModel(new DefaultComboBoxModel(ProfileFacade</span>
<span class="nc" id="L316">                .getManager().getSearchPathDirectories().toArray()));</span>
<span class="nc" id="L317">    }</span>

    private List&lt;Profile&gt; getUsedProfiles() {
<span class="nc" id="L320">        return new ArrayList&lt;Profile&gt;(ProfileFacade.getManager()</span>
<span class="nc" id="L321">                .getDefaultProfiles());</span>
    }

    private List&lt;Profile&gt; getAvailableProfiles() {
<span class="nc" id="L325">        List&lt;Profile&gt; used = getUsedProfiles();</span>
<span class="nc" id="L326">        List&lt;Profile&gt; ret = new ArrayList&lt;Profile&gt;();</span>

<span class="nc bnc" id="L328" title="All 2 branches missed.">        for (Profile profile : ProfileFacade.getManager()</span>
<span class="nc" id="L329">                .getRegisteredProfiles()) {</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">            if (!used.contains(profile)) {</span>
<span class="nc" id="L331">                ret.add(profile);</span>
            }
<span class="nc" id="L333">        }</span>

<span class="nc" id="L335">        return ret;</span>
    }

    /*
     * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
     */
    public void actionPerformed(ActionEvent arg0) {
<span class="nc" id="L342">        MutableComboBoxModel modelAvl = ((MutableComboBoxModel) availableList</span>
<span class="nc" id="L343">                .getModel());</span>
<span class="nc" id="L344">        MutableComboBoxModel modelUsd = ((MutableComboBoxModel) defaultList</span>
<span class="nc" id="L345">                .getModel());</span>

<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (arg0.getSource() == addButton) {</span>
<span class="nc" id="L348">            Object[] selections = availableList.getSelectedValues();</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">            for (Object s : selections) {</span>
<span class="nc" id="L350">                Profile selected = (Profile) s;</span>
<span class="nc" id="L351">                modelUsd.addElement(selected);</span>
<span class="nc" id="L352">                modelAvl.removeElement(selected);</span>
            }
<span class="nc bnc" id="L354" title="All 2 branches missed.">        } else if (arg0.getSource() == removeButton) {</span>
<span class="nc" id="L355">            Object[] selections = defaultList.getSelectedValues();</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">            for (Object s : selections) {</span>
<span class="nc" id="L357">                Profile selected = (Profile) s;</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">                if (selected == ProfileFacade.getManager().getUMLProfile()</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">                        &amp;&amp; Model.getFacade().getUmlVersion().charAt(0) != '1') {</span>
<span class="nc" id="L360">                    JOptionPane.showMessageDialog(this, Translator</span>
<span class="nc" id="L361">                            .localize(&quot;tab.profiles.cantremoveuml&quot;));</span>
                } else {
<span class="nc" id="L363">                    modelUsd.removeElement(selected);</span>
<span class="nc" id="L364">                    modelAvl.addElement(selected);</span>
                }
            }
<span class="nc bnc" id="L367" title="All 2 branches missed.">        } else if (arg0.getSource() == loadFromFile) {</span>
            JFileChooser fileChooser =
<span class="nc" id="L369">                UserDefinedProfileHelper.createUserDefinedProfileFileChooser();</span>
<span class="nc" id="L370">            int ret = fileChooser.showOpenDialog(this);</span>
<span class="nc" id="L371">            List&lt;File&gt; files = null;</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">            if (ret == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L373">                files = UserDefinedProfileHelper.getFileList(</span>
<span class="nc" id="L374">                    fileChooser.getSelectedFiles());</span>
            }
<span class="nc bnc" id="L376" title="All 4 branches missed.">            if (files != null &amp;&amp; files.size() &gt; 0) {</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">                for (File file : files) {</span>
                    try {
<span class="nc" id="L379">                        UserDefinedProfile profile =</span>
                            new UserDefinedProfile(file,
<span class="nc" id="L381">                                ProfileFacade.getManager());</span>
<span class="nc" id="L382">                        ProfileFacade.getManager().registerProfile(profile);</span>
<span class="nc" id="L383">                        modelAvl.addElement(profile);</span>
<span class="nc" id="L384">                    } catch (ProfileException e) {</span>
<span class="nc" id="L385">                        JOptionPane.showMessageDialog(this, Translator</span>
<span class="nc" id="L386">                            .localize(&quot;tab.profiles.userdefined.errorloading&quot;)</span>
<span class="nc" id="L387">                            + &quot;: &quot; + file.getAbsolutePath());</span>
<span class="nc" id="L388">                    }</span>
<span class="nc" id="L389">                }</span>
            }

<span class="nc bnc" id="L392" title="All 2 branches missed.">        } else if (arg0.getSource() == removeDirectory) {</span>
<span class="nc" id="L393">            MutableComboBoxModel model = </span>
<span class="nc" id="L394">                ((MutableComboBoxModel) directoryList.getModel()); </span>
<span class="nc" id="L395">            Object[] selections = directoryList.getSelectedValues();</span>
<span class="nc bnc" id="L396" title="All 2 branches missed.">            for (Object o : selections) {</span>
<span class="nc" id="L397">                model.removeElement(o);</span>
            }
<span class="nc bnc" id="L399" title="All 2 branches missed.">        } else if (arg0.getSource() == refreshProfiles) {</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">            boolean refresh = JOptionPane.showConfirmDialog(this, Translator</span>
<span class="nc" id="L401">                    .localize(&quot;tab.profiles.confirmrefresh&quot;), Translator</span>
<span class="nc" id="L402">                    .localize(&quot;tab.profiles.confirmrefresh.title&quot;),</span>
                    JOptionPane.YES_NO_OPTION) == JOptionPane.YES_OPTION;
<span class="nc bnc" id="L404" title="All 2 branches missed.">            if (refresh) {</span>
<span class="nc" id="L405">                handleSettingsTabSave();</span>
<span class="nc" id="L406">                ProfileFacade.getManager().refreshRegisteredProfiles();</span>
<span class="nc" id="L407">                refreshLists();</span>
            }
<span class="nc bnc" id="L409" title="All 2 branches missed.">        } else if (arg0.getSource() == addDirectory) {</span>
<span class="nc" id="L410">            JFileChooser fileChooser = new JFileChooser();</span>
<span class="nc" id="L411">            fileChooser.setFileFilter(new FileFilter() {</span>

                public boolean accept(File file) {
<span class="nc" id="L414">                    return file.isDirectory();</span>
                }

                public String getDescription() {
<span class="nc" id="L418">                    return &quot;Directories&quot;;</span>
                }

            });

<span class="nc" id="L423">            fileChooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);</span>

<span class="nc" id="L425">            int ret = fileChooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">            if (ret == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L427">                File file = fileChooser.getSelectedFile();</span>

                // find and add all subdirectories
<span class="nc" id="L430">                Collection&lt;File&gt; dirs = new ArrayList&lt;File&gt;();</span>
<span class="nc" id="L431">                collectSubdirs(file, dirs);</span>
                
<span class="nc" id="L433">                MutableComboBoxModel cbModel = </span>
<span class="nc" id="L434">                    ((MutableComboBoxModel) directoryList.getModel());</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">                for (File dir : dirs) {</span>
<span class="nc" id="L436">                    cbModel.addElement(dir.getAbsolutePath());</span>
<span class="nc" id="L437">                }</span>
            }
        }

<span class="nc" id="L441">        availableList.validate();</span>
<span class="nc" id="L442">        defaultList.validate();</span>
<span class="nc" id="L443">    }</span>

    private void collectSubdirs(File file, Collection&lt;File&gt; subdirs) {
<span class="nc" id="L446">        subdirs.add(file);</span>
<span class="nc" id="L447">        File[] files = file.listFiles();</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">        if (files != null) {</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">            for (File f : files) {</span>
<span class="nc bnc" id="L450" title="All 4 branches missed.">                if (f.isDirectory() &amp; !f.isHidden()) {</span>
<span class="nc" id="L451">                    collectSubdirs(f, subdirs);</span>
                }
            }
        }
<span class="nc" id="L455">    }</span>

    /**
     * @return the internationalization key that containing the name of this tab
     * @see org.argouml.application.api.GUISettingsTabInterface#getTabKey()
     */
    public String getTabKey() {
<span class="nc" id="L462">        return &quot;tab.profiles&quot;;</span>
    }

    /**
     * @return the panel containing this tab
     * @see org.argouml.application.api.GUISettingsTabInterface#getTabPanel()
     */
    public JPanel getTabPanel() {
<span class="nc" id="L470">        return this;</span>
    }

    public void handleResetToDefault() {
<span class="nc bnc" id="L474" title="All 2 branches missed.">        if (!initialized) {</span>
<span class="nc" id="L475">            buildPanel();</span>
        }
<span class="nc" id="L477">        refreshLists();</span>
<span class="nc" id="L478">    }</span>

    public void handleSettingsTabCancel() {
<span class="nc" id="L481">    }</span>

    public void handleSettingsTabRefresh() {
<span class="nc bnc" id="L484" title="All 2 branches missed.">        if (!initialized) {</span>
<span class="nc" id="L485">            buildPanel();</span>
        }
<span class="nc" id="L487">        refreshLists();</span>

<span class="nc bnc" id="L489" title="All 4 branches missed.">        switch (Configuration.getInteger(</span>
                ProfileConfiguration.KEY_DEFAULT_STEREOTYPE_VIEW,
                DiagramAppearance.STEREOTYPE_VIEW_TEXTUAL)) {
        case DiagramAppearance.STEREOTYPE_VIEW_TEXTUAL:
<span class="nc" id="L493">            stereoField.setSelectedIndex(0);</span>
<span class="nc" id="L494">            break;</span>
        case DiagramAppearance.STEREOTYPE_VIEW_BIG_ICON:
<span class="nc" id="L496">            stereoField.setSelectedIndex(1);</span>
<span class="nc" id="L497">            break;</span>
        case DiagramAppearance.STEREOTYPE_VIEW_SMALL_ICON:
<span class="nc" id="L499">            stereoField.setSelectedIndex(2);</span>
            break;
        }
<span class="nc" id="L502">    }</span>

    public void handleSettingsTabSave() {
<span class="nc" id="L505">        List&lt;Profile&gt; toRemove = new ArrayList&lt;Profile&gt;();</span>
<span class="nc" id="L506">        List&lt;Profile&gt; usedItens = new ArrayList&lt;Profile&gt;();</span>

<span class="nc" id="L508">        MutableComboBoxModel modelUsd = ((MutableComboBoxModel) defaultList</span>
<span class="nc" id="L509">                .getModel());</span>
<span class="nc" id="L510">        MutableComboBoxModel modelDir = ((MutableComboBoxModel) directoryList</span>
<span class="nc" id="L511">                .getModel());</span>

<span class="nc bnc" id="L513" title="All 2 branches missed.">        for (int i = 0; i &lt; modelUsd.getSize(); ++i) {</span>
<span class="nc" id="L514">            usedItens.add((Profile) modelUsd.getElementAt(i));</span>
        }

        for (Profile profile 
<span class="nc bnc" id="L518" title="All 2 branches missed.">                : ProfileFacade.getManager().getDefaultProfiles()) {</span>
<span class="nc bnc" id="L519" title="All 2 branches missed.">            if (!usedItens.contains(profile)) {</span>
<span class="nc" id="L520">                toRemove.add(profile);</span>
            }
<span class="nc" id="L522">        }</span>

<span class="nc bnc" id="L524" title="All 2 branches missed.">        for (Profile profile : toRemove) {</span>
<span class="nc" id="L525">            ProfileFacade.getManager().removeFromDefaultProfiles(profile);</span>
<span class="nc" id="L526">        }</span>

<span class="nc bnc" id="L528" title="All 2 branches missed.">        for (Profile profile : usedItens) {</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">            if (!ProfileFacade.getManager().getDefaultProfiles().contains(</span>
                    profile)) {
<span class="nc" id="L531">                ProfileFacade.getManager().addToDefaultProfiles(profile);</span>
            }
<span class="nc" id="L533">        }</span>

<span class="nc" id="L535">        List&lt;String&gt; toRemoveDir = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L536">        List&lt;String&gt; usedItensDir = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L538" title="All 2 branches missed.">        for (int i = 0; i &lt; modelDir.getSize(); ++i) {</span>
<span class="nc" id="L539">            usedItensDir.add((String) modelDir.getElementAt(i));</span>
        }

<span class="nc bnc" id="L542" title="All 2 branches missed.">        for (String dirEntry : ProfileFacade.getManager()</span>
<span class="nc" id="L543">                .getSearchPathDirectories()) {</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">            if (!usedItensDir.contains(dirEntry)) {</span>
<span class="nc" id="L545">                toRemoveDir.add(dirEntry);</span>
            }
<span class="nc" id="L547">        }</span>

<span class="nc bnc" id="L549" title="All 2 branches missed.">        for (String dirEntry : toRemoveDir) {</span>
<span class="nc" id="L550">            ProfileFacade.getManager().removeSearchPathDirectory(dirEntry);</span>
<span class="nc" id="L551">        }</span>

<span class="nc bnc" id="L553" title="All 2 branches missed.">        for (String dirEntry : usedItensDir) {</span>
<span class="nc" id="L554">            if (!ProfileFacade.getManager().getSearchPathDirectories()</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">                    .contains(dirEntry)) {</span>
<span class="nc" id="L556">                ProfileFacade.getManager().addSearchPathDirectory(dirEntry);</span>
            }
<span class="nc" id="L558">        }</span>

<span class="nc" id="L560">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>